(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2101],{26917:(e,t,r)=>{"use strict";r.d(t,{default:()=>O});var s=r(95155),a=r(39092),o=r.n(a),l=r(73321),i=r(12115),n=r(98500),d=r.n(n),c=r(47936),u=r(6962),m=r(9921),g=r(66088),p=r(20232),x=r(97810),b=r(48368),h=r(92564),f=r(49619),y=r(56204),w=r(29857),v=r(52484),k=r(66614),j=r(59695),_=r(77805),N=r(66609),$=r(30913),C=r(5669),S=r(28393),L=r(99799),E=r(75238),I=r(94655),T=r(99776),A=r(28776);let P={mitochondrion:"https://upload.wikimedia.org/wikipedia/commons/thumb/3/3b/Animal_mitochondrion_diagram_en.svg/1200px-Animal_mitochondrion_diagram_en.svg.png","animal cell":"https://upload.wikimedia.org/wikipedia/commons/thumb/6/68/Animal_cell_structure_en.svg/1200px-Animal_cell_structure_en.svg.png","plant cell":"https://upload.wikimedia.org/wikipedia/commons/thumb/4/4b/Plant_cell_structure_svg.svg/1200px-Plant_cell_structure_svg.svg.png","eukaryotic cell":"https://upload.wikimedia.org/wikipedia/commons/thumb/6/68/Animal_cell_structure_en.svg/1200px-Animal_cell_structure_en.svg.png","prokaryotic cell":"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5a/Prokaryote_cell.svg/1200px-Prokaryote_cell.svg.png",chloroplast:"https://upload.wikimedia.org/wikipedia/commons/thumb/1/10/Chloroplast_diagram.svg/1200px-Chloroplast_diagram.svg.png",nucleus:"https://upload.wikimedia.org/wikipedia/commons/thumb/7/71/Diagram_human_cell_nucleus.svg/1200px-Diagram_human_cell_nucleus.svg.png",ribosome:"https://upload.wikimedia.org/wikipedia/commons/thumb/0/0f/Ribosome_mRNA_translation_en.svg/1200px-Ribosome_mRNA_translation_en.svg.png",neuron:"https://upload.wikimedia.org/wikipedia/commons/thumb/8/8e/Complete_neuron_cell_diagram_en.svg/1200px-Complete_neuron_cell_diagram_en.svg.png",heart:"https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/Diagram_of_the_human_heart_%28cropped%29.svg/1200px-Diagram_of_the_human_heart_%28cropped%29.svg.png","digestive system":"https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/Digestive_system_diagram_en.svg/800px-Digestive_system_diagram_en.svg.png",dna:"https://upload.wikimedia.org/wikipedia/commons/thumb/9/9f/DNA_double_helix.svg/800px-DNA_double_helix.svg.png","dna structure":"https://upload.wikimedia.org/wikipedia/commons/thumb/4/4c/DNA_Structure%2BKey%2BLabelled.pn_NoBB.png/1200px-DNA_Structure%2BKey%2BLabelled.pn_NoBB.png","protein synthesis":"https://upload.wikimedia.org/wikipedia/commons/thumb/0/0c/Protein_synthesis.svg/1200px-Protein_synthesis.svg.png","periodic table":"https://upload.wikimedia.org/wikipedia/commons/thumb/8/89/Colour_18-col_PT_with_labels.svg/1200px-Colour_18-col_PT_with_labels.svg.png","water molecule":"https://upload.wikimedia.org/wikipedia/commons/thumb/b/b7/H2O_2D_labelled.svg/800px-H2O_2D_labelled.svg.png",benzene:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Benzene-2D-full.svg/800px-Benzene-2D-full.svg.png","electromagnetic spectrum":"https://upload.wikimedia.org/wikipedia/commons/thumb/c/cf/EM_Spectrum_Properties_edit.svg/1200px-EM_Spectrum_Properties_edit.svg.png",atom:"https://upload.wikimedia.org/wikipedia/commons/thumb/6/6f/Stylised_atom_with_three_Bohr_model_orbits_and_stylised_nucleus.svg/800px-Stylised_atom_with_three_Bohr_model_orbits_and_stylised_nucleus.svg.png","solar system":"https://upload.wikimedia.org/wikipedia/commons/thumb/c/cb/Planets2013.svg/1200px-Planets2013.svg.png"};var D=r(71876);function O(){(0,l.useParams)();let e=(0,l.useSearchParams)(),t=(0,l.useRouter)(),{user:r,refreshToken:a,fetchUser:n}=(0,S.h)(),{authLoading:O}=(0,L.w)();if(O)return(0,s.jsx)(E.A,{});if(!r)return null;let F=decodeURIComponent(e.get("topic")||""),z=e.get("originalTopic"),M=e.get("format")||"course",q=e.get("difficulty")||"beginner",B=e.get("existing"),R=z?decodeURIComponent(z):F,W=e.get("id")||e.get("courseId"),[U,J]=(0,i.useState)("outline"),[H,G]=(0,i.useState)(new Set),[K,Q]=(0,i.useState)(new Set([1])),[V,X]=(0,i.useState)({moduleId:parseInt(e.get("moduleId"))||1,lessonIndex:parseInt(e.get("lessonIndex"))||0}),[Y,Z]=(0,i.useState)(""),[ee,et]=(0,i.useState)(!1),[er,es]=(0,i.useState)(""),[ea,eo]=(0,i.useState)([{type:"ai",message:"Hi! I'm your AI tutor. I'm here to help you understand the concepts better. Feel free to ask me any questions about the lesson!",timestamp:new Date}]),[el,ei]=(0,i.useState)(null),[en,ed]=(0,i.useState)(!0),[ec,eu]=(0,i.useState)(null),[em,eg]=(0,i.useState)(!1),[ep,ex]=(0,i.useState)(""),eb=(0,i.useRef)(!1),eh=(0,i.useRef)(new Set),ef=(0,i.useRef)(null),ey=(0,i.useRef)({}),ew=(0,i.useRef)(null),ev=(0,i.useRef)(null),[ek,ej]=(0,i.useState)(!1),[e_,eN]=(0,i.useState)(null),[e$,eC]=(0,i.useState)(!0),eS=(0,i.useRef)(null),[eL,eE]=(0,i.useState)(null),[eI,eT]=(0,i.useState)(!1),[eA,eP]=(0,i.useState)(!1),[eD,eO]=(0,i.useState)([]),[eF,ez]=(0,i.useState)({}),[eM,eq]=(0,i.useState)(!1),eB=()=>{let e=el?._id||`${R}-${M}-${q}`;return`conversation_${e}`},eR=()=>{let e=el?._id||`${R}-${M}-${q}`;return`progress_${e}`},eW=e=>{try{localStorage.setItem(eB(),JSON.stringify(e))}catch(e){}try{(0,C.Ud)("/api/library",{method:"POST",body:JSON.stringify({action:"saveConversation",courseId:el?._id||null,topic:R,difficulty:q,format:M,messages:e})}).catch(()=>{})}catch(e){}},eU=async()=>{try{let e=localStorage.getItem(eB());if(e)return void eo(JSON.parse(e))}catch{}try{let e=await (0,C.Ud)("/api/library",{method:"POST",body:JSON.stringify({action:"getConversation",courseId:el?._id||null,topic:R,difficulty:q,format:M})});if(e.ok){let t=await e.json();if(Array.isArray(t.messages)&&t.messages.length){eo(t.messages);try{localStorage.setItem(eB(),JSON.stringify(t.messages))}catch{}}}}catch{}},eJ=(0,i.useRef)(null),eH=(0,i.useRef)(null);(0,i.useEffect)(()=>{if(el?._id){eU();let e=new Set;el.modules&&el.modules.forEach(t=>{t.lessons&&t.lessons.forEach(r=>{r.completed&&e.add(r.id||`${t.id}-${t.lessons.indexOf(r)}`)})});let t=localStorage.getItem(eR()),r=new Set([...e,...t?new Set(JSON.parse(t)):new Set]);G(r),r.size>0&&localStorage.setItem(eR(),JSON.stringify(Array.from(r)))}},[el?._id,el?.modules]),(0,i.useEffect)(()=>{if(W||el?._id){let e=W||el?._id,t=`last_position_${e}`,r=JSON.stringify(V);localStorage.setItem(t,r)}},[V,W,el?._id]),(0,i.useEffect)(()=>{let e=()=>{eC(!0),eS.current&&clearTimeout(eS.current),eS.current=setTimeout(()=>{eC(!1)},3e3)};return eS.current=setTimeout(()=>{eC(!1)},3e3),window.addEventListener("mousemove",e),window.addEventListener("touchstart",e),window.addEventListener("keydown",e),window.addEventListener("scroll",e,!0),()=>{eS.current&&clearTimeout(eS.current),window.removeEventListener("mousemove",e),window.removeEventListener("touchstart",e),window.removeEventListener("keydown",e),window.removeEventListener("scroll",e,!0)}},[]);let[eG,eK]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(_.Ii.isNativePlatform())return j.s3.addListener("keyboardWillShow",()=>{eK(!0)}),j.s3.addListener("keyboardWillHide",()=>{eK(!1)}),()=>{j.s3.removeAllListeners()}},[]),(0,i.useEffect)(()=>{ev.current&&(ev.current.scrollTop=ev.current.scrollHeight)},[ea]),(0,i.useEffect)(()=>{let e=document.documentElement.classList.contains("dark");A.A.initialize({startOnLoad:!1,theme:e?"dark":"base",padding:20,themeVariables:e?{darkMode:!0,background:"#0f172a",primaryColor:"#1e293b",secondaryColor:"#334155",tertiaryColor:"#0f172a",primaryTextColor:"#e2e8f0",secondaryTextColor:"#cbd5e1",primaryBorderColor:"#475569",lineColor:"#94a3b8",fontSize:"16px",fontFamily:"ui-sans-serif, system-ui, sans-serif"}:{darkMode:!1,background:"#ffffff",primaryColor:"#e0e7ff",secondaryColor:"#f3f4f6",tertiaryColor:"#fff",primaryTextColor:"#374151",secondaryTextColor:"#4b5563",primaryBorderColor:"#d1d5db",lineColor:"#6b7280",fontSize:"16px",fontFamily:"ui-sans-serif, system-ui, sans-serif"}});let t=setTimeout(()=>{A.A.run({nodes:document.querySelectorAll(".mermaid"),suppressErrors:!0}).then(()=>{document.querySelectorAll(".mermaid svg").forEach(e=>{let t=e.parentElement;if(t&&t.getAttribute("data-code")){let e=decodeURIComponent(t.getAttribute("data-code"));ey.current[e]=t.innerHTML}})}).catch(e=>console.debug("Mermaid error (harmless)",e))},100);return()=>clearTimeout(t)},[V,el]),(0,i.useEffect)(()=>{let e=new MutationObserver(()=>{let e=document.documentElement.classList.contains("dark");A.A.initialize({startOnLoad:!1,theme:e?"dark":"base",padding:20,themeVariables:e?{darkMode:!0,background:"#0f172a",primaryColor:"#1e293b",secondaryColor:"#334155",tertiaryColor:"#0f172a",primaryTextColor:"#e2e8f0",secondaryTextColor:"#cbd5e1",primaryBorderColor:"#475569",lineColor:"#94a3b8",fontSize:"16px",fontFamily:"ui-sans-serif, system-ui, sans-serif"}:{darkMode:!1,background:"#ffffff",primaryColor:"#e0e7ff",secondaryColor:"#f3f4f6",tertiaryColor:"#fff",primaryTextColor:"#374151",secondaryTextColor:"#4b5563",primaryBorderColor:"#d1d5db",lineColor:"#6b7280",fontSize:"16px",fontFamily:"ui-sans-serif, system-ui, sans-serif"}}),setTimeout(()=>{A.A.run({nodes:document.querySelectorAll(".mermaid")}).catch(e=>console.debug("Mermaid theme switch error",e))},50)});return e.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>e.disconnect()},[]),(0,i.useEffect)(()=>{document.querySelectorAll(".wikipedia-diagram-container").forEach(e=>{let t=e.getAttribute("data-topic");if("true"!==e.getAttribute("data-processed")){e.setAttribute("data-processed","true");try{let r=P[t.toLowerCase().trim()]||null;r?e.innerHTML=`
            <div class="max-w-2xl mx-auto">
              <img 
                src="${r}" 
                alt="${t} diagram from Wikipedia" 
                class="w-full h-auto rounded-lg shadow-lg border border-gray-200 dark:border-gray-700"
              />
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-2 text-center">
                <a href="https://commons.wikimedia.org" target="_blank" class="hover:underline">
                  ðŸ“š Diagram from Wikimedia Commons
                </a>
              </p>
            </div>
          `:e.innerHTML=`
            <div class="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800 text-center">
              <p class="text-yellow-700 dark:text-yellow-400 text-sm">Wikipedia diagram for "${t}" not available in library</p>
            </div>
          `}catch(t){console.error("Wikipedia diagram error:",t),e.innerHTML=`
          <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-200 dark:border-red-800 text-center">
            <p class="text-red-600 dark:text-red-400 text-sm">Failed to load diagram: ${t.message}</p>
          </div>
        `}}})},[V,el]);let[eQ,eV]=(0,i.useState)("notes");(0,i.useEffect)(()=>{window.innerWidth>=1024?(eT(!0),eP(!0)):(eT(!0),eP(!1))},[]);let eX=async(e,t)=>{ef.current&&(ef.current.abort(),ef.current=null),X({moduleId:e,lessonIndex:t}),eg(!1),ex(""),window.innerWidth<1024&&eT(!1);let r=el?.modules?.find(t=>t.id===e),s=r?.lessons?.[t],a=`lesson_${R}_${q}_${e}_${t}`,o=localStorage.getItem(a);o&&""!==o.trim()&&"Content for this lesson is coming soon..."!==o.trim()?ei(r=>{let s={...r};return s.modules&&s.modules[e-1]&&s.modules[e-1].lessons[t]&&(s.modules[e-1].lessons[t].content=o),s}):(s&&(!s.content||""===s.content.trim()||"Content will be generated when you start the lesson."===s.content)&&eZ(e,t,s.title,r.title),eY(e,t))},eY=async(e,t)=>{if(el?._id)try{Z("");let r=`course_${el._id}`,s=`${e}-${t}`,a=await (0,C.Ud)(`/api/notes?itemId=${r}&lessonId=${s}`);if(a.ok){let e=await a.json();e.notes&&e.notes.length>0&&Z(e.notes[0].content)}}catch(e){console.warn("Failed to fetch lesson notes:",e)}},eZ=async(e,t,r,s)=>{try{let a=new AbortController;ef.current=a,eg(!0),ex("");let o=await (0,C.Ud)("/api/course-agent",{method:"POST",signal:a.signal,body:JSON.stringify({action:"generateLesson",courseId:el?._id||null,moduleId:e,lessonIndex:t,lessonTitle:r,moduleTitle:s,courseTopic:F,difficulty:q})});if(!o.ok)throw Error("Failed to generate lesson content");let l=await o.json();ei(r=>{let s={...r};return s.modules&&s.modules[e-1]&&s.modules[e-1].lessons[t]&&(s.modules[e-1].lessons[t].content=l.content),s});let i=`lesson_${R}_${q}_${e}_${t}`;try{localStorage.setItem(i,l.content),window.dispatchEvent(new Event("usageUpdated"))}catch(e){}ex(l.content)}catch(r){if("AbortError"===r.name)return void console.log("Fetch aborted");console.error(r),N.toast.error("Failed to load lesson content"),ei(r=>{let s={...r};return s.modules&&s.modules[e-1]&&s.modules[e-1].lessons[t]&&(s.modules[e-1].lessons[t].content="Failed to load content. Please try again."),s})}finally{null===ef.current||(eg(!1),ef.current=null)}},e0=async(e,t)=>{let r=el.modules.find(t=>t.id===e),s=r?.lessons[t],a=s?.id||`${e}-${t+1}`,o=new Set(H);o.has(a)?o.delete(a):o.add(a),G(o);try{if(localStorage.setItem(eR(),JSON.stringify(Array.from(o))),el?._id){let e=el?.totalLessons||0,t=e>0?Math.round(o.size/e*100):0,r=await (0,C.Ud)("/api/course-progress",{method:"POST",body:JSON.stringify({courseId:el._id,progress:t,completed:100===t,isLessonCompleted:o.has(a),lessonId:a})});if(!r.ok)throw Error(`Failed to save progress: ${r.statusText}`)}}catch(e){N.toast.error("Failed to save progress to the cloud.")}},e1=async()=>{if(!er.trim())return;if(!(r?.subscription&&("pro"===r.subscription.plan||"enterprise"===r.subscription.plan)&&"active"===r.subscription.status||r?.isPremium)){let e=`ai_responses_${new Date().toDateString()}`,t=parseInt(localStorage.getItem(e)||"0",10);if(t>=3)return void N.toast.error("Daily AI tutor limit reached (3 responses of â‰¤50 words). Upgrade to Pro for unlimited responses.");localStorage.setItem(e,String(t+1))}let e={type:"user",message:er,timestamp:new Date};eo(t=>{let r=[...t,e];return eW(r),r}),es("");let t={type:"ai",message:"Thinking...",timestamp:new Date,isLoading:!0};eo(e=>{let r=[...e,t];return eW(r),r});try{let t=el?.modules?.flatMap(e=>e.lessons?.map(t=>({moduleTitle:e.title,lessonTitle:t.title,content:t.content||""}))||[]).map(e=>`Module: ${e.moduleTitle}
Lesson: ${e.lessonTitle}
Content: ${e.content}`).join("\n\n---\n\n")||"",r=await (0,C.Ud)("/api/course-agent",{method:"POST",body:JSON.stringify({action:"checkRelevance",question:e.message,courseContent:t,lessonTitle:e3?.title||"",context:`Course: ${el?.title||""}, Level: ${el?.level||""}, Topic: ${F}. Module: ${el?.modules?.find(e=>e.id===V.moduleId)?.title||""}`})});if(!r.ok)throw Error("Failed to check question relevance");if(!(await r.json()).relevant){let e=el?.title||"this course";eo(t=>{let r=[...t.filter(e=>!e.isLoading),{type:"ai",message:`I'm here to help with this course on **${e}**. What would you like to know about it?`,timestamp:new Date}];return eW(r),r});return}let s=await (0,C.Ud)("/api/course-agent",{method:"POST",body:JSON.stringify({action:"answer",question:e.message,courseContent:t,lessonTitle:e3?.title||"",context:`Course: ${el?.title||""}, Level: ${el?.level||""}, Topic: ${F}. Module: ${el?.modules?.find(e=>e.id===V.moduleId)?.title||""}`})});if(!s.ok)throw Error("Failed to get AI response");let a=await s.json();eo(e=>{let t=e.filter(e=>!e.isLoading),r=e2(a.response||""),s=[...t,{type:"ai",message:r,html:!0,timestamp:new Date}];return eW(s),s})}catch(e){eo(e=>{let t=[...e.filter(e=>!e.isLoading),{type:"ai",message:"I'm sorry, I'm having trouble responding right now. Please try again later.",timestamp:new Date}];return eW(t),t})}},e2=e=>{if(!e)return"";let t=e;if((t=t.trim()).startsWith("```markdown")||t.startsWith("```md")||t.startsWith("```")){let e=t.indexOf("\n");-1!==e&&(t=t.substring(e+1)),t.endsWith("```")&&(t=t.substring(0,t.lastIndexOf("```")).trim())}t=t.replace(/\[Wikipedia Diagram:\s*([^\]]+)\]/gi,(e,t)=>{let r=t.trim();return`<div class="wikipedia-diagram-container my-6 flex justify-center" data-topic="${r}">
        <div class="max-w-2xl mx-auto">
          <div class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
            <div class="animate-pulse text-center">
              <div class="text-gray-500 dark:text-gray-400 mb-2">ðŸ“š Loading Wikipedia diagram...</div>
              <div class="text-sm text-gray-400 dark:text-gray-500">${r}</div>
            </div>
          </div>
        </div>
      </div>`});let r=[];t=t.replace(/```(\w+)?\s*\n([\s\S]*?)```/g,(e,t,s)=>{let a=s.trim();if("mermaid"===t){let e="mermaid-container my-6 flex justify-center p-6 rounded-lg overflow-x-auto border border-gray-200 dark:border-gray-700 shadow-sm transition-colors duration-200",t="bg-white dark:bg-gray-900",r=a.replace(/\[([\s\S]*?)\]/g,(e,t)=>/[()",]/.test(t)?`["${t.trim().replace(/"/g,'""')}"]`:e),s=ey.current[r];return s?`<div class="${e} ${t}">${s}</div>`:`<div class="mermaid ${e} ${t}" data-code="${encodeURIComponent(r)}">${r}</div>`}let o=`___CODEBLOCK_${r.length}___`;return r.push(`<pre class="bg-gray-900 dark:bg-gray-950 p-4 rounded-lg overflow-x-auto my-4 border border-gray-700"><code class="text-sm text-green-400 language-${t||"plaintext"}">${a.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</code></pre>`),o});let s=[],a=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/`([^`]+)`/g,(e,t)=>{let r=`___INLINECODE_${s.length}___`;return s.push(`<code class="bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded text-sm font-mono text-blue-600 dark:text-blue-400">${t}</code>`),r})).replace(/(\$\$|\\\[)([\s\S]*?)(\$\$|\\\])/g,(e,t,r)=>{try{return`<div class="my-6 overflow-x-auto flex justify-center">${D.default.renderToString(r.trim(),{displayMode:!0,throwOnError:!1})}</div>`}catch(t){return e}})).replace(/(\$|\\\() ([\s\S]*?) ([\s\S]*?)(\$|\\\))/g,(e,t,r,s,a)=>{let o=(r+s).trim();try{return D.default.renderToString(o,{displayMode:!1,throwOnError:!1})}catch(t){return e}})).replace(RegExp("(?<!\\\\)\\$([^\\$\\n]+?)\\$","g"),(e,t)=>{try{return D.default.renderToString(t.trim(),{displayMode:!1,throwOnError:!1})}catch(t){return e}})).replace(/^# (.*$)/gm,'<h1 class="text-3xl font-bold text-blue-600 dark:text-blue-400 underline decoration-blue-500/30 mb-6 mt-8">$1</h1>')).replace(/^## (.*$)/gm,'<h2 class="text-2xl font-semibold text-blue-600 dark:text-blue-400 underline decoration-blue-500/30 mb-4 mt-6">$1</h2>')).replace(/^### (.*$)/gm,'<h3 class="text-xl font-semibold text-gray-800 dark:text-gray-200 mb-3 mt-5">$1</h3>')).replace(/^#### (.*$)/gm,'<h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2 mt-4">$1</h4>')).replace(/^##### (.*$)/gm,'<h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2 mt-4">$1</h4>')).replace(/^> (.*$)/gm,'<blockquote class="border-l-4 border-blue-500 pl-4 py-2 my-4 bg-blue-50 dark:bg-blue-900/20 text-gray-700 dark:text-gray-300 italic rounded-r">$1</blockquote>')).replace(/\*\*([^\*\n]+?)\*\*/g,'<strong class="font-bold text-gray-900 dark:text-gray-100">$1</strong>')).replace(/\*([^\*\n]+?)\*/g,'<em class="italic text-gray-800 dark:text-gray-200">$1</em>')).replace(/<\/strong>\s*<em>/gi,"</strong><br><em>").replace(/<\/b>\s*<em>/gi,"</b><br><em>").replace(/<\/strong>\s*<i>/gi,"</strong><br><i>").replace(/<\/b>\s*<i>/gi,"</b><br><i>")).split("\n"),o=!1,l=!1,i="";t=a.map(e=>{let t=e.match(/<h[123][^>]*>(.*?)<\/h[123]>/i);t&&(i=t[1].replace(/<[^>]*>/g,"").trim());let r=/^\s*\d+\.\s+/.test(e),s=/^\s*[-â€¢*]\s+/.test(e),a=i.toLowerCase().includes("practice exercise");if(r){let t=e.replace(/^\s*\d+\.\s+/,"").trim();if(a&&!o)return l?`<li class="flex items-start gap-3 pt-2"><span class="text-black dark:text-white font-bold mt-1">âœ”</span><span class="font-medium">${t}</span></li>`:(l=!0,`<ul class="list-none mb-6 space-y-4 text-gray-700 dark:text-gray-300 ml-2"><li class="flex items-start gap-3"><span class="text-black dark:text-white font-bold mt-1">âœ”</span><span class="font-medium">${t}</span></li>`);let r="";return(l&&(l=!1,r+="</ul>"),o)?r+'<li class="pt-2">'+t+"</li>":(o=!0,r+'<ol class="list-decimal list-outside mb-6 space-y-4 text-gray-700 dark:text-gray-300 ml-8"><li class="pt-2">'+t+"</li>")}if(s){let t=e.replace(/^\s*[-â€¢*]\s+/,""),r=/^\s{2,}/.test(e);return o?'<ul class="list-disc list-inside ml-6 text-gray-600 dark:text-gray-400"><li class="pt-1">'+t+"</li></ul>":l?a?r?`<li class="ml-10 py-1 border-l-2 border-indigo-500/20 pl-4 italic text-gray-600 dark:text-gray-400">${t}</li>`:`<li class="flex items-start gap-3 pt-2"><span class="text-black dark:text-white font-bold mt-1">âœ”</span><span class="font-medium">${t}</span></li>`:'<li class="pt-2">'+t+"</li>":(l=!0,a)?'<ul class="list-none mb-6 space-y-4 text-gray-700 dark:text-gray-300 ml-2">'+(r?`<li class="ml-10 py-1 border-l-2 border-indigo-500/20 pl-4 italic text-gray-600 dark:text-gray-400">${t}</li>`:`<li class="flex items-start gap-3"><span class="text-black dark:text-white font-bold mt-1">âœ”</span><span class="font-medium">${t}</span></li>`):'<ul class="list-disc list-outside mb-6 space-y-4 text-gray-700 dark:text-gray-300 ml-8"><li class="pt-2">'+t+"</li>"}{let t="";return l&&a&&/^\s{2,}/.test(e)?`<li class="ml-10 py-1 border-l-2 border-indigo-500/20 pl-4 italic text-gray-600 dark:text-gray-400">${e.trim()}</li>`:(l&&(l=!1,t+="</ul>"),o&&(o=!1,t+="</ol>"),t+e)}}).join("\n"),o&&(t+="</ol>"),l&&(t+="</ul>");let n=[];return t=(t=(t=(t=(t=t.split("\n\n").map(e=>(e=e.trim())&&!e.startsWith("<")?`<p class="mb-4 text-gray-700 dark:text-gray-300 leading-loose">${e}</p>`:e).join("\n")).replace(/^---+$/gm,'<div class="my-4"></div>')).replace(/^#? ?Module:.*$/igm,"")).replace(/^#? ?Mermaid diagram for.*$/igm,"")).replace(/(\n|^)(\|.*\|(\n|$))+/g,e=>{let t=`___TABLE_${n.length}___`,r=e.trim().split("\n").filter(e=>e.trim()),s='<div class="overflow-x-auto my-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm"><table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">',a=r[0].split("|").filter(e=>""!==e.trim()).map(e=>e.trim());s+='<thead class="bg-gray-50 dark:bg-gray-800"><tr>',a.forEach(e=>{s+=`<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">${e}</th>`}),s+='</tr></thead><tbody class="bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700">';for(let e=2;e<r.length;e++){let t=r[e].split("|").filter(e=>""!==e.trim()).map(e=>e.trim());s+="<tr>",t.forEach(e=>{s+=`<td class="px-6 py-4 whitespace-normal text-sm text-gray-700 dark:text-gray-300">${e}</td>`}),s+="</tr>"}return s+="</tbody></table></div>",n.push(s),t}),r.forEach((e,r)=>{t=t.replace(`___CODEBLOCK_${r}___`,e)}),s.forEach((e,r)=>{t=t.replace(`___INLINECODE_${r}___`,e)}),n.forEach((e,r)=>{t=t.replace(`___TABLE_${r}___`,e)}),t},e4=el&&el.modules?el.modules.reduce((e,t)=>e+t.lessons.length,0):0,e6=H.size,e5=e4>0?e6/e4*100:0,e3=(()=>{if(!el||!el.modules)return null;let e=el.modules.find(e=>e.id===V.moduleId);if(!e)return null;let t=e.lessons[V.lessonIndex];return"string"==typeof t?{title:t,content:"Content for this lesson is coming soon..."}:t})(),e8=async e=>{if(e.trim())try{et(!0);let t=await (0,C.Ud)("/api/notes",{method:"POST",body:JSON.stringify({itemId:`course_${el?._id}`,lessonId:`${V.moduleId}-${V.lessonIndex}`,content:e,title:e3?.title||"Lesson Notes"})});if(!t.ok)throw Error("Failed to save notes");let r=await t.json();console.log("Notes saved:",r.message),N.toast.success("Notes saved")}catch(e){console.error("Error saving notes:",e),N.toast.error("Failed to save notes")}finally{et(!1)}},e7=async()=>{if(!Y||!Y.trim())return void N.toast.error("No notes to download");let e={title:e3?.title||"Lesson Notes",content:Y,date:new Date().toLocaleDateString(),course:el.title,tags:["Learning",el?.level||"General"]};N.toast.loading("Preparing your study notes PDF...",{id:"downloading-notes"});try{await (0,$.n$)(e),N.toast.success("Notes downloaded successfully!",{id:"downloading-notes"})}catch(e){console.error("PDF download error:",e),N.toast.error("Failed to generate PDF. Please try again.",{id:"downloading-notes"})}};return((0,i.useEffect)(()=>{if(Y.trim()&&el){let e=setTimeout(()=>{e8(Y)},2e3);return()=>clearTimeout(e)}},[Y,el,V]),(0,i.useEffect)(()=>{let s=`${R}/${M}/${q}`;eh.current.clear();let a=!0;return(async()=>{let o,l;if(eb.current)return console.log("Fetch already in progress, skipping");eb.current=!0,console.log("Setting isLoading to true"),ed(!0),eu(null);let i=!!(r?.subscription&&("pro"===r.subscription.plan||"enterprise"===r.subscription.plan)&&"active"===r.subscription.status)||!!r?.isPremium;try{let e=Object.keys(localStorage).filter(e=>e.startsWith("lesson_"));if(e.length>50){let t=e.sort((e,t)=>Math.random()-.5).slice(50);t.forEach(e=>{localStorage.removeItem(e)}),console.log(`ðŸ§¹ Cleaned up ${t.length} old lesson entries from localStorage`)}}catch(e){console.warn("Failed to cleanup localStorage:",e)}if(W)try{let e=await (0,C.Ud)(`/api/library?id=${W}`,{headers:{"Content-Type":"application/json"}});if(e.ok){let t=(await e.json()).item;if(t){let e=t.courseData||t;if((e.modules&&e.modules.length>0||e.topics&&e.topics.length>0)&&(console.log("âœ… Found exact course in library by ID"),a)){ei({...e,_id:t._id}),ed(!1);return}}}}catch(e){console.error("ID fetch failed, falling back to topic search",e)}try{let e=await (0,C.Ud)(`/api/library?search=${encodeURIComponent(R)}&limit=50`);if(e.ok){let t=await e.json(),r=t.items?.find(e=>{if("course"!==e.type)return!1;let t=e.topic?.toLowerCase()===R.toLowerCase()||e.originalTopic?.toLowerCase()===R.toLowerCase()||e.courseData?.topic?.toLowerCase()===R.toLowerCase(),r=e.difficulty?.toLowerCase()===q.toLowerCase()||e.level?.toLowerCase()===q.toLowerCase()||e.courseData?.difficulty?.toLowerCase()===q.toLowerCase()||e.courseData?.level?.toLowerCase()===q.toLowerCase();return t&&r});if(r&&(r.modules&&r.modules.length>0||r.courseData?.modules&&r.courseData.modules.length>0)){if(console.log("âœ… Found existing course in library:",r.title||r.courseData?.title),!a)return;let e=r.courseData||r,t={...e};ei(t);let o=new Set;e.modules&&e.modules.forEach(e=>{e.lessons&&e.lessons.forEach((t,r)=>{let s=t.id||`${e.id}-${r+1}`;t.completed&&o.add(s)})});let l=e._id||`${R}-${M}-${q}`,i=`progress_${l}`,n=localStorage.getItem(i);if(n)try{JSON.parse(n).forEach(e=>o.add(e)),console.log("âœ… Restored completed lessons from DB and localStorage:",Array.from(o))}catch(e){console.warn("Failed to parse saved progress:",e)}else console.log("âœ… Restored completed lessons from DB:",Array.from(o));G(o),console.log("âœ… Found course in library, setting isLoading to false"),console.log("Setting isLoading to false (library)"),ed(!1),window.dispatchEvent(new CustomEvent("actinova:loading-done")),setTimeout(()=>{let e=document.querySelectorAll("[data-actinova-loader-overlay], [data-actinova-loader]");e.length&&(console.warn("Detected leftover loaders after library load, removing...",e.length),e.forEach(e=>e.remove()))},1e3),eb.current=!1,eh.current.add(s);return}console.log("generating course...")}}catch(e){console.log("Library check error:",e)}if("flashcards"===M)try{let e=await (0,C.Ud)("/api/flashcards",{cache:"no-store"});if(e.ok){let t=await e.json();console.log("Flashcards data received:",t);let r=t.find(e=>{let t=e.topic?.toLowerCase()===R.toLowerCase()||e.originalTopic?.toLowerCase()===R.toLowerCase(),r=e.difficulty?.toLowerCase()===q.toLowerCase()||e.level?.toLowerCase()===q.toLowerCase();return console.log("Checking card set:",e.title,{matchesTopic:t,matchesDifficulty:r,cardTopic:e.topic||e.originalTopic,cardDifficulty:e.difficulty||e.level}),t&&r});if(r){console.log("âœ… Loading existing questions:",r.title,"Cards:",r.totalCards),ei(r),console.log("âœ… Found questions in library, setting isLoading to false"),ed(!1),eb.current=!1,eh.current.add(s);return}console.log("âŒ Question set not found in cards collection")}}catch(e){console.log("Cards check error:",e)}if("quiz"===M&&B)try{let e=await fetch(`/api/quizzes/${B}`);if(e.ok){let t=await e.json();ei(t),console.log("âœ… Loaded existing quiz:",t.title),ed(!1),eb.current=!1,eh.current.add(s);return}}catch(e){console.log("Error loading existing quiz:",e)}if(!i&&"beginner"!==q){N.toast.error("Intermediate and Advanced levels require Pro subscription. Redirecting to upgrade..."),t.push("/dashboard?tab=upgrade"),console.log("âœ… Free user trying non-beginner difficulty, setting isLoading to false and redirecting"),console.log("Setting isLoading to false (free user redirect)"),ed(!1),eb.current=!1,eh.current.add(s);return}"quiz"===M?(o="/api/generate-course",l={topic:R,format:"quiz",difficulty:i?q:"beginner",questions:parseInt(e.get("questions"))||10}):"flashcards"===M?(o="/api/generate-flashcards",l={topic:R,format:M,difficulty:i?q:"beginner"}):(o="/api/generate-course",l="guide"===M?{topic:R,difficulty:(i?q:"beginner").toLowerCase()}:{topic:R,format:M,difficulty:(i?q:"beginner").toLowerCase()});try{let e,t=await (0,C.Ud)(o,{method:"POST",body:JSON.stringify(l)});if(!t.ok){if(429===t.status){let e=await t.json();if(!a)return;eN({used:e.used||0,limit:e.limit||2,isPremium:e.isPremium||!1}),ej(!0),ed(!1),eb.current=!1;return}let e=await t.json();throw console.error("Course generation debug:",JSON.stringify(e)),Error(e.details||e.error||"Failed to generate course")}let r=await t.json();if(r.content?e=r.content:(r.modules,e=r),"course"===M){if(!(Array.isArray(e.modules)&&e.modules.length>0||Array.isArray(e.topics)&&e.topics.length>0))throw console.error("Course generation failed: Invalid structure"),Error("Generated course structure is invalid. Please try again.")}else if("quiz"===M&&!(Array.isArray(e.questions)&&e.questions.length>0))throw Error("Generated quiz has no questions. Please try again.");if(r.courseId&&(e._id=r.courseId),ei(e),ed(!1),window.dispatchEvent(new CustomEvent("actinova:loading-done")),setTimeout(()=>{window.dispatchEvent(new CustomEvent("actinova:loading-done"))},50),setTimeout(()=>{let e=document.querySelectorAll("[data-actinova-loader-overlay], [data-actinova-loader]");e.length&&(console.warn("Detected leftover loaders after generation, removing...",e.length),e.forEach(e=>e.remove()))},1e3),!r.isExisting)try{let t=await (0,C.Ud)("/api/library",{method:"POST",body:JSON.stringify({action:"add",course:{isGenerated:!0,courseData:e,title:e.title,topic:e.topic||R,level:e.level||q,format:M}})});if(t.ok)try{let e=await t.json();console.log("Course saved to library:",e)}catch(e){console.warn("Library response was not JSON")}else{let e=await t.text();console.warn("Failed to store course in library:",{status:t.status,statusText:t.statusText,response:e})}}catch(e){console.warn("Error storing course in library:",e)}try{await n(),window.dispatchEvent(new CustomEvent("usageUpdated"))}catch(e){console.warn("Failed to refresh user usage after generation",e)}eh.current.add(s),console.log("Course data set successfully")}catch(e){console.error("Error fetching course data:",JSON.stringify(e,Object.getOwnPropertyNames(e))),a&&(eu(e.message),N.toast.error(`Failed to load course: ${e.message}`))}finally{console.log("Finally block executed, setting isLoading to false"),a&&(console.log("Setting isLoading to false (finally)"),ed(!1),window.dispatchEvent(new CustomEvent("actinova:loading-done")),setTimeout(()=>{let e=document.querySelectorAll("[data-actinova-loader-overlay], [data-actinova-loader]");e.length&&(console.warn("Detected leftover loaders in finally block, removing...",e.length),e.forEach(e=>e.remove()))},1e3)),eb.current=!1}setTimeout(()=>{a&&eb.current&&(console.log("Safety timeout: forcing isLoading to false"),ed(!1),eb.current=!1,window.dispatchEvent(new CustomEvent("actinova:loading-done")),setTimeout(()=>{let e=document.querySelectorAll("[data-actinova-loader-overlay], [data-actinova-loader]");e.length&&(console.warn("Detected leftover loaders from safety timeout, removing...",e.length),e.forEach(e=>e.remove()))},1e3))},3e4)})(),()=>{a=!1}},[R,M,q]),(0,i.useEffect)(()=>{!el||100==e6/e4*100&&e6>0&&(Date.now(),el.title,new Date().toLocaleDateString(),el.level,N.toast.success("\uD83C\uDF89 Congratulations! You've completed the course!"))},[e6,e4,el]),(0,i.useLayoutEffect)(()=>{el&&en&&ed(!1)},[el,en]),en&&!el)?(0,s.jsx)(E.A,{text:"quiz"===M?"Generating your test":"guide"===M?"Generating your questions":"Generating your course"}):ec?(0,s.jsx)("div",{className:"h-[calc(100vh-6rem)] flex flex-col bg-gray-50 dark:bg-gray-900 overflow-hidden",children:(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center max-w-md mx-auto p-6",children:[(0,s.jsx)("div",{className:"text-red-500 mb-4",children:(0,s.jsx)("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Failed to generate course"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:ec}),(0,s.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Try Again"})]})})}):el?"flashcards"===M?(0,s.jsx)(I.A,{cardData:el}):"quiz"===M?(0,s.jsx)(T.A,{quizData:el,topic:F,existingQuizId:B}):(0,s.jsxs)("div",{className:"h-screen flex flex-col bg-gray-50 dark:bg-gray-900 overflow-hidden pt-safe-top",onTouchStart:e=>{eH.current=null,eJ.current=e.targetTouches[0].clientX},onTouchMove:e=>{eH.current=e.targetTouches[0].clientX},onTouchEnd:()=>{if(!eJ.current||!eH.current)return;let e=eJ.current-eH.current;e<-50?eT(!0):e>50&&eT(!1)},children:[(0,s.jsxs)("div",{className:"flex flex-1 overflow-hidden relative",children:[eI&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-30 lg:hidden",onClick:()=>eT(!1)}),eA&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-30 lg:hidden",onClick:()=>eP(!1)}),(0,s.jsxs)("div",{className:`${eI?"translate-x-0":"-translate-x-full"} w-full lg:w-80 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col absolute z-40 transition-transform duration-300 max-w-[90vw] md:max-w-[400px] h-full overflow-y-auto hide-scrollbar shadow-xl pb-32 pb-safe-bottom`,children:[(0,s.jsxs)("div",{className:"p-4 lg:p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("div",{className:"flex justify-between flex-wrap flex-col",children:(0,s.jsx)("h2",{className:"font-bold text-lg text-gray-900 dark:text-gray-100 mb-2",children:el.title})}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:[el.totalModules," modules â€¢ ",el.totalLessons," ","lessons"]}),(0,s.jsxs)("button",{onClick:()=>{if(!(r&&(r.subscription&&"pro"===r.subscription.plan&&"active"===r.subscription.status||r.isPremium))){N.toast.error("PDF downloads are a Pro feature. Please upgrade."),t.push("/dashboard?tab=upgrade");return}try{(0,$.O5)(el,M),N.toast.success("PDF download started!")}catch(e){console.error("Error downloading PDF:",e),N.toast.error("Failed to download PDF")}},disabled:!(r&&(r.subscription&&"pro"===r.subscription.plan&&"active"===r.subscription.status||r.isPremium)),className:r&&(r.subscription&&"pro"===r.subscription.plan&&"active"===r.subscription.status||r.isPremium)?"w-full mb-4 flex items-center justify-center space-x-2 px-4 py-2 rounded-lg transition-colors text-sm font-medium bg-blue-600 text-white hover:bg-blue-700":"w-full mb-4 flex items-center justify-center space-x-2 px-4 py-2 rounded-lg transition-colors text-sm font-medium bg-gray-300 dark:bg-gray-700 text-gray-600 dark:text-gray-400 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,s.jsx)(u.A,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:r&&(r.subscription&&"pro"===r.subscription.plan&&"active"===r.subscription.status||r.isPremium)?`Download ${"flashcards"===M?"Flashcards":"Course"} as PDF`:"Upgrade to Pro for PDF"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,s.jsxs)("div",{className:"w-8 h-8 bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-400 rounded-full flex items-center justify-center text-sm font-semibold",children:[Math.round(e5),"%"]}),(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Completed"})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${e5}%`}})})]}),(0,s.jsx)("div",{className:"flex-1",children:Array.isArray(el.modules)&&el.modules.map((e,t)=>(0,s.jsxs)("div",{className:"border-b border-gray-200 dark:border-gray-700 last:border-b-0",children:[(0,s.jsxs)("button",{onClick:()=>{var t;let r;return t=e.id,void((r=new Set(K)).has(t)?r.delete(t):r.add(t),Q(r))},className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400 rounded-full flex items-center justify-center text-sm font-medium",children:t+1}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 text-left",children:e.title})]}),K.has(e.id)?(0,s.jsx)(m.A,{className:"w-4 h-4 text-gray-400"}):(0,s.jsx)(g.A,{className:"w-4 h-4 text-gray-400"})]}),K.has(e.id)&&(0,s.jsx)("div",{className:"bg-gray-50 dark:bg-gray-700",children:e.lessons.map((t,r)=>{let a="string"==typeof t?t:t.title,o=t?.id||`${e.id}-${r+1}`,l=H.has(o),i=V.moduleId===e.id&&V.lessonIndex===r;return(0,s.jsxs)("button",{onClick:()=>eX(e.id,r),className:`w-full p-3 pl-12 flex items-center justify-between hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors ${i?"bg-blue-50 dark:bg-blue-900/20 border-r-2 border-blue-500":""}`,children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center text-xs font-medium ${l?"bg-green-500 border-green-500 text-white":"border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-400"}`,children:l?"âœ“":r+1}),(0,s.jsx)("span",{className:`text-sm text-left ${i?"text-blue-600 dark:text-blue-400 font-medium":"text-gray-700 dark:text-gray-300"}`,children:a})]}),!l&&(0,s.jsx)(p.A,{className:"w-4 h-4 text-gray-400"})]},r)})})]},e?.id??t))})]}),(0,s.jsx)("div",{className:"flex-1 flex flex-col overflow-hidden",children:(0,s.jsx)("div",{ref:ew,className:"flex-1 overflow-y-auto hide-scrollbar bg-white dark:bg-gray-800",children:(0,s.jsx)("div",{style:{paddingBottom:e$?"calc(10rem + env(safe-area-inset-bottom))":"calc(2rem + env(safe-area-inset-bottom))"},className:`mx-auto p-4 sm:p-6 lg:p-8 transition-all duration-300 ${eA&&eI?"max-w-4xl":"max-w-5xl"}`,children:em?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Generating lesson content..."}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Please wait while we create personalized content for you"})]}):e3?.content?(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"mb-6 pb-4 border-b border-gray-200 dark:border-gray-700",children:(0,s.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white",children:e3.title||"Lesson Content"})}),(0,s.jsx)("div",{className:"prose prose-sm sm:prose-base lg:prose-lg dark:prose-invert max-w-none",children:(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:e2(e3.content)}})})]}):(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(x.A,{className:"w-12 h-12 text-blue-500 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Select a lesson to start learning"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Choose a lesson from the sidebar to begin"})]})})})}),(0,s.jsxs)("div",{style:{paddingBottom:e$?"calc(4rem + env(safe-area-inset-bottom))":"env(safe-area-inset-bottom)"},className:`${eA?"translate-x-0":"translate-x-full"} w-full lg:w-80 xl:w-96 bg-white dark:bg-gray-800 border-l border-gray-200 dark:border-gray-700 flex flex-col absolute z-40 transition-transform duration-300 max-w-[100vw] md:max-w-[400px] right-0 h-full shadow-xl`,children:[(0,s.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 relative",children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsxs)("button",{onClick:()=>eV("notes"),className:`flex-1 px-3 py-2 sm:px-4 sm:py-3 text-xs sm:text-sm font-medium border-b-2 transition-colors ${"notes"===eQ?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[(0,s.jsx)(b.A,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1 sm:mr-2"}),"Notes"]}),(0,s.jsxs)("button",{onClick:()=>eV("chat"),className:`flex-1 px-3 py-2 sm:px-4 sm:py-3 text-xs sm:text-sm font-medium border-b-2 transition-colors ${"chat"===eQ?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[(0,s.jsx)(h.A,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1 sm:mr-2"}),"AI Tutor"]})]})}),(0,s.jsx)("div",{className:"flex-1 overflow-hidden",children:"notes"===eQ?(0,s.jsxs)("div",{className:"h-full flex flex-col",children:[(0,s.jsxs)("div",{className:"p-3 sm:p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("h3",{className:"font-semibold text-sm sm:text-base text-gray-900 dark:text-gray-100",children:"My Notes"}),(0,s.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Take notes while learning"})]}),(0,s.jsxs)("div",{className:"flex-1 p-3 sm:p-4",children:[(0,s.jsx)("textarea",{value:Y,onChange:e=>Z(e.target.value),placeholder:"Write your notes here... remember to download them before leaving this page!!",className:"w-full h-full resize-none overflow-y-auto hide-scrollbar bg-transparent text-sm sm:text-base text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400",dir:"ltr",style:{direction:"ltr",unicodeBidi:"plaintext"}}),ee&&(0,s.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"Saving..."})]}),(0,s.jsx)("div",{className:"p-3 sm:p-4 border-t border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("button",{onClick:()=>{r&&(r.subscription&&"pro"===r.subscription.plan&&"active"===r.subscription.status||r.isPremium)?e7():N.toast.error("Notes PDF export is a Pro feature. Please upgrade.")},disabled:!Y.trim()||!(r&&(r.subscription&&"pro"===r.subscription.plan&&"active"===r.subscription.status||r.isPremium)),className:r&&(r.subscription&&"pro"===r.subscription.plan&&"active"===r.subscription.status||r.isPremium)?"w-full flex items-center justify-center space-x-1 sm:space-x-2 py-1.5 sm:py-4 px-3 sm:px-4 text-sm rounded-lg transition-colors sm:p-x3 bg-blue-600 text-white hover:bg-blue-700":"w-full flex items-center justify-center space-x-1 sm:space-x-2 py-1.5 sm:py-4 px-3 sm:px-4 text-sm rounded-lg disabled:opacity-50 transition-colors sm:p-x3 bg-gray-300 dark:bg-gray-700 text-gray-600 dark:text-gray-400",children:[(0,s.jsx)(u.A,{className:"w-3 h-3 sm:w-4 sm:h-4"}),(0,s.jsx)("span",{children:r&&(r.subscription&&"pro"===r.subscription.plan&&"active"===r.subscription.status||r.isPremium)?"Download Notes":"Pro: Notes PDF"})]})})]}):(0,s.jsxs)("div",{className:"h-full flex flex-col bg-[#e5ddd5] dark:bg-[#0b141a] relative overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute inset-0 opacity-[0.05] dark:opacity-[0.03] pointer-events-none",style:{backgroundImage:'url("https://www.transparenttextures.com/patterns/cubes.png")',backgroundRepeat:"repeat"}}),(0,s.jsx)("div",{className:"p-3 sm:p-4 border-b border-gray-200/50 dark:border-gray-700/50 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md z-10 flex items-center justify-between",children:(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"font-semibold text-sm sm:text-base text-gray-900 dark:text-gray-100 flex items-center",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"}),"AI Tutor"]}),(0,s.jsx)("p",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400",children:"Online & ready to help"})]})}),(0,s.jsxs)("div",{ref:ev,className:"jsx-c56b0bdabd8066c1 flex-1 overflow-y-auto scrollbar-hide p-3 sm:p-4 space-y-3 z-10",children:[(0,s.jsx)(o(),{id:"c56b0bdabd8066c1",children:".scrollbar-hide.jsx-c56b0bdabd8066c1::-webkit-scrollbar{display:none}"}),ea.map((e,t)=>{let r="user"===e.type,a=e.timestamp?new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"";return(0,s.jsx)("div",{className:`jsx-c56b0bdabd8066c1 flex ${r?"justify-end":"justify-start"} animate-in fade-in slide-in-from-bottom-2 duration-300`,children:(0,s.jsxs)("div",{className:`jsx-c56b0bdabd8066c1 max-w-[85%] px-3 py-2 rounded-xl text-sm relative shadow-sm ${r?"bg-blue-600 dark:bg-blue-700 text-white rounded-tr-none":"bg-white dark:bg-[#202c33] text-gray-900 dark:text-gray-100 rounded-tl-none"}`,children:[!r&&(0,s.jsxs)("div",{className:"jsx-c56b0bdabd8066c1 flex items-center space-x-2 mb-1 opacity-70",children:[(0,s.jsx)(f.A,{className:"w-3 h-3 text-blue-500"}),(0,s.jsx)("span",{className:"jsx-c56b0bdabd8066c1 text-[10px] font-bold uppercase tracking-wider",children:"AI Tutor"})]}),e.html?(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:e.message},className:"jsx-c56b0bdabd8066c1 prose prose-sm dark:prose-invert max-w-none break-words"}):(0,s.jsx)("p",{className:"jsx-c56b0bdabd8066c1 whitespace-pre-wrap break-words",children:e.message}),(0,s.jsxs)("div",{className:`jsx-c56b0bdabd8066c1 text-[10px] mt-1 flex justify-end items-center space-x-1 opacity-50 ${r?"text-gray-700 dark:text-gray-300":"text-gray-500 dark:text-gray-400"}`,children:[(0,s.jsx)("span",{className:"jsx-c56b0bdabd8066c1",children:a}),r&&(0,s.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",className:"jsx-c56b0bdabd8066c1 w-3 h-3 text-blue-500",children:[(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",className:"jsx-c56b0bdabd8066c1"}),(0,s.jsx)("path",{d:"M20 10l-11 11-5-5",className:"jsx-c56b0bdabd8066c1 translate-x-1"})]})]})]})},t)})]}),(0,s.jsx)("div",{className:"p-3 sm:p-4 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md border-t border-gray-200/50 dark:border-gray-700/50 z-10 transition-all",children:(0,s.jsxs)("div",{className:"flex items-end space-x-2 max-w-full",children:[(0,s.jsx)("div",{className:"flex-1 bg-white dark:bg-[#2a3942] rounded-2xl shadow-sm border border-gray-200 dark:border-transparent focus-within:border-blue-500 transition-all flex items-end p-1",children:(0,s.jsx)("textarea",{value:er,onChange:e=>{es(e.target.value),e.target.style.height="auto",e.target.style.height=Math.min(e.target.scrollHeight,120)+"px"},onKeyDown:e=>{"Enter"===e.key&&!e.shiftKey&&(e.preventDefault(),er.trim()&&(e1(),e.target.style.height="auto"))},placeholder:"Type a message",className:"flex-1 px-3 py-2 bg-transparent text-sm text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none resize-none max-h-[120px]",rows:1})}),(0,s.jsx)("button",{onClick:()=>{e1();let e=document.querySelector('textarea[placeholder="Type a message"]');e&&(e.style.height="auto")},disabled:!er.trim(),className:`p-3 rounded-full flex items-center justify-center transition-all ${er.trim()?"bg-[#00a884] shadow-lg scale-100 hover:bg-[#008f72] active:scale-95":"bg-gray-300 dark:bg-gray-700 opacity-50 cursor-not-allowed scale-90"}`,children:(0,s.jsx)(y.A,{className:`w-5 h-5 text-white ${er.trim()?"translate-x-0.5 -translate-y-0.5":""}`})})]})})]})})]})]}),(0,s.jsx)(c.P.div,{initial:{y:0},animate:{y:e$&&!eG?0:100},transition:{duration:.3,ease:"easeInOut"},className:"fixed bottom-0 left-0 right-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg border-t border-gray-200 dark:border-gray-800 pb-safe-bottom z-50",children:(0,s.jsxs)("div",{className:"flex justify-around items-center h-14 px-2",children:[(0,s.jsxs)("button",{onClick:()=>{eT(!eI),eI||eP(!1)},className:`flex flex-col items-center justify-center w-full h-full space-y-1 ${eI?"text-blue-600 dark:text-blue-400":"text-gray-500 dark:text-gray-400"}`,children:[(0,s.jsx)(w.A,{size:22,strokeWidth:2}),(0,s.jsx)("span",{className:"text-[10px] font-medium",children:"Modules"})]}),(0,s.jsxs)("button",{onClick:async()=>{if(!V||em)return;let e=el?.modules?.find(e=>e.id===V.moduleId),t=e?.lessons?.[V.lessonIndex],r=t?.id||`${V.moduleId}-${V.lessonIndex+1}`,s=H.has(r)?"incomplete":"complete";N.toast.loading(`Marking lesson as ${s}...`,{id:"mark-complete"});try{await e0(V.moduleId,V.lessonIndex),N.toast.success(`Lesson marked as ${s}!`,{id:"mark-complete"})}catch(e){N.toast.error(`Error: ${e.message}`,{id:"mark-complete"})}},className:`flex flex-col items-center justify-center w-full h-full space-y-1 ${H.has(el?.modules?.find(e=>e.id===V.moduleId)?.lessons?.[V.lessonIndex]?.id||`${V.moduleId}-${V.lessonIndex+1}`)?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"}`,disabled:!e3?.content||em,children:[(0,s.jsx)(v.A,{size:22,strokeWidth:2,className:H.has(el?.modules?.find(e=>e.id===V.moduleId)?.lessons?.[V.lessonIndex]?.id||`${V.moduleId}-${V.lessonIndex+1}`)?"fill-current opacity-20":""}),(0,s.jsx)("span",{className:"text-[10px] font-medium",children:"Status"})]}),(0,s.jsxs)(d(),{href:"/dashboard",className:"flex flex-col items-center justify-center w-full h-full space-y-1 text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400",children:[(0,s.jsx)(k.A,{size:22,strokeWidth:2}),(0,s.jsx)("span",{className:"text-[10px] font-medium",children:"Home"})]}),(0,s.jsxs)("button",{onClick:()=>{r&&(r.subscription?.plan==="pro"&&r.subscription?.status==="active"||r.isPremium)?e3?.content&&((0,$.n$)({title:e3.title,content:e3.content}),N.toast.success("Downloading...")):N.toast.error("Pro feature. Please upgrade to download.")},className:"flex flex-col items-center justify-center w-full h-full space-y-1 text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400",children:[(0,s.jsx)(u.A,{size:22,strokeWidth:2}),(0,s.jsx)("span",{className:"text-[10px] font-medium",children:"Save"})]}),(0,s.jsxs)("button",{onClick:()=>{eP(!eA),eA||eT(!1)},className:`flex flex-col items-center justify-center w-full h-full space-y-1 ${eA?"text-blue-600 dark:text-blue-400":"text-gray-500 dark:text-gray-400"}`,children:[(0,s.jsx)(h.A,{size:22,strokeWidth:2}),(0,s.jsx)("span",{className:"text-[10px] font-medium",children:"Tools"})]})]})}),ek&&e_&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-orange-100 dark:bg-orange-900 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)("svg",{className:"w-8 h-8 text-orange-600 dark:text-orange-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Monthly Limit Reached"}),(0,s.jsxs)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:["You've used ",e_.used," of ",e_.limit," free"," ","flashcards"===M?"flashcard sets":"courses"," this month."]}),(0,s.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mb-6",children:(0,s.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["Upgrade to Pro for unlimited"," ","flashcards"===M?"flashcards":"courses"," and premium features!"]})}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{onClick:()=>{ej(!1),eN(null)},className:"flex-1 px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Maybe Later"}),(0,s.jsx)("button",{onClick:()=>{ej(!1),eN(null),t.push("/dashboard?tab=upgrade")},className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Upgrade to Pro"})]})]})})})]}):(0,s.jsx)("div",{className:"h-[calc(100vh-6rem)] flex flex-col bg-gray-50 dark:bg-gray-900 overflow-hidden",children:(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"No course data available"})})})})}r(84559)},65117:(e,t,r)=>{Promise.resolve().then(r.bind(r,26917)),Promise.resolve().then(r.bind(r,72773)),Promise.resolve().then(r.bind(r,71552))}},e=>{e.O(0,[5846,3930,293,590,7330,6609,8500,7805,24,639,8894,2295,6788,913,9776,2261,8441,3794,7358],()=>e(e.s=65117)),_N_E=e.O()}]);