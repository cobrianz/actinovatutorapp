"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8393],{5669:(e,r,t)=>{t.d(r,{e:()=>o});var a=t(41463);let s=window.origin?.startsWith("capacitor://")||window.origin?.startsWith("http://localhost")||window.origin?.startsWith("https://localhost")||"capacitor:"===window.location.protocol||!!window.Capacitor;console.log("[Actinova] Environment:",{origin:window.origin,isCapacitor:s,protocol:window.location.protocol});let n=a.env.NEXT_PUBLIC_API_URL||"https://actinovatutorapp.vercel.app";function o(e){if(!e)return n;if(e.startsWith("http://")||e.startsWith("https://"))return e;let r=e.startsWith("/")?e:`/${e}`;return s?`${n}${r}`:r}console.log("[Actinova] API_BASE_URL configured as:",n)},28393:(e,r,t)=>{t.d(r,{AuthProvider:()=>f,h:()=>h});var a=t(95155),s=t(12115),n=t(73321),o=t(37206),i=t(5669);let c=(0,o.default)(()=>t.e(7408).then(t.bind(t,27408)),{loadableGenerated:{webpack:()=>[27408]},ssr:!1}),l=(0,o.default)(()=>Promise.all([t.e(6609),t.e(2209)]).then(t.bind(t,2209)),{loadableGenerated:{webpack:()=>[2209]},ssr:!1}),u=(0,s.createContext)();function d(){if("undefined"==typeof document)return null;let e=document.cookie.match(/csrfToken=([^;]+)/);return e?e[1]:null}function f({children:e}){let[r,t]=(0,s.useState)(null),[o,f]=(0,s.useState)(!0),[h,p]=(0,s.useState)(null),[m,y]=(0,s.useState)(!1),[g,w]=(0,s.useState)(120),v=(0,n.useRouter)(),T=(0,n.usePathname)(),k=(0,s.useRef)(null),E=(0,s.useRef)(null),b=(0,s.useRef)(null),S=(0,s.useRef)(Date.now()),C=(0,s.useRef)(null);(0,s.useEffect)(()=>{},[]);let j=(0,s.useCallback)(async()=>(C.current||(C.current=(async()=>{try{if(!(await fetch((0,i.e)("/api/refresh"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})).ok)return!1;try{let e=await fetch((0,i.e)("/api/me"),{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(e.ok){let r=await e.json();t(r.user)}}catch(e){console.error("Failed to re-fetch profile after refresh:",e)}return!0}catch(e){return console.error("Token refresh failed:",e),!1}finally{C.current=null}})()),C.current),[]),P=(0,s.useCallback)(async()=>{try{p(null),console.log(`[Actinova] Fetching user from: ${(0,i.e)("/api/me")}`);let e=await fetch((0,i.e)("/api/me"),{credentials:"include",headers:{"Content-Type":"application/json"}});console.log(`[Actinova] /api/me status: ${e.status}`);let r=null;if(e.ok){let a=await e.text();try{return r=JSON.parse(a),t(r.user),f(!1),r.user}catch(e){throw console.error(`[Actinova] Failed to parse /api/me JSON. Response text: ${a.substring(0,100)}...`),Error("Invalid server response format")}}if(401===e.status&&await j()){let e=await fetch((0,i.e)("/api/me"),{credentials:"include",headers:{"Content-Type":"application/json"}});if(e.ok)return r=await e.json(),t(r.user),f(!1),r.user}return t(null),null}catch(e){console.error("Failed to fetch user:",e),p(e.message)}finally{f(!1)}},[j]);(0,s.useEffect)(()=>{P()},[P]),(0,s.useEffect)(()=>{if(!r)return;let e=async()=>{"visible"===document.visibilityState&&await j()};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[r,j]),(0,s.useEffect)(()=>{!o&&r&&T.startsWith("/auth")&&"/auth/verify-email"!==T&&(!1===r.onboardingCompleted?v.replace("/onboarding"):v.replace("/dashboard"))},[r,o,T,v]);let O=(0,s.useCallback)(()=>{S.current=Date.now(),k.current&&clearTimeout(k.current),E.current&&clearTimeout(E.current),b.current&&clearInterval(b.current),y(!1),w(120),r&&(E.current=setTimeout(()=>{y(!0),w(120),b.current=setInterval(()=>{w(e=>e<=1?(L(),0):e-1)},1e3)},78e4),k.current=setTimeout(()=>{L()},9e5))},[r]),L=(0,s.useCallback)(async()=>{k.current&&clearTimeout(k.current),E.current&&clearTimeout(E.current),b.current&&clearInterval(b.current);try{await fetch((0,i.e)("/api/logout"),{method:"POST",credentials:"include",headers:{"X-CSRF-Token":d()}})}catch(e){console.error("Logout failed:",e)}t(null),y(!1),v.push("/?loggedOut=inactivity")},[v]),A=(0,s.useCallback)(()=>{O()},[O]);(0,s.useEffect)(()=>{if(!r)return;let e=["mousedown","mousemove","keypress","scroll","touchstart","click"],t=()=>{O()};return e.forEach(e=>{document.addEventListener(e,t,!0)}),O(),()=>{e.forEach(e=>{document.removeEventListener(e,t,!0)}),k.current&&clearTimeout(k.current),E.current&&clearTimeout(E.current),b.current&&clearInterval(b.current)}},[r,O]),(0,s.useEffect)(()=>{r||(k.current&&clearTimeout(k.current),E.current&&clearTimeout(E.current),b.current&&clearInterval(b.current),y(!1))},[r]);let R=async e=>{try{p(null),f(!0);let r=await fetch((0,i.e)("/api/login"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)}),t=await r.json();if(!r.ok){if(console.error("[Actinova] Login failed status:",r.status,"data:",t),t.requiresVerification)return{success:!1,error:t.error||"Please verify your email first",requiresVerification:!0,email:t.email};throw Error(t.error||"Login failed")}console.log("[Actinova] Login successful, fetching user profile...");let a=await P();return{success:!0,user:a}}catch(e){return console.error("[Actinova] Login exception:",e),p(e.message),{success:!1,error:e.message}}finally{f(!1)}},I=async e=>{try{p(null),f(!0);let r=await fetch((0,i.e)("/api/signup"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)}),t=await r.json();if(!r.ok)throw Error(t.error||"Signup failed");return{success:!0,message:t.message,requiresVerification:t.requiresVerification}}catch(e){return p(e.message),{success:!1,error:e.message}}finally{f(!1)}},x=async()=>{try{p(null),await fetch((0,i.e)("/api/logout"),{method:"POST",credentials:"include",headers:{"X-CSRF-Token":d()}})}catch(e){console.error("Logout failed:",e)}finally{t(null),p(null),v.push("/")}},F=async e=>{try{p(null);let r=await fetch((0,i.e)("/api/forgot-password"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),t=await r.json();if(!r.ok)throw Error(t.error||"Failed to send reset email");return{success:!0,message:t.message}}catch(e){return p(e.message),{success:!1,error:e.message}}},N=async(e,r,t)=>{try{p(null);let a=await fetch((0,i.e)("/api/reset-password"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,password:r,confirmPassword:t})}),s=await a.json();if(!a.ok)throw Error(s.error||"Failed to reset password");return{success:!0,message:s.message}}catch(e){return p(e.message),{success:!1,error:e.message}}},_=async e=>{try{p(null);let r=await fetch((0,i.e)("/api/verify-email"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})}),t=await r.json();if(!r.ok)throw Error(t.error||"Failed to verify email");return{success:!0,message:t.message}}catch(e){return p(e.message),{success:!1,error:e.message}}};return(0,a.jsx)(u.Provider,{value:{user:r,loading:o,error:h,showInactivityModal:m,timeRemaining:g,login:R,signup:I,logout:x,forgotPassword:F,resetPassword:N,verifyEmail:_,refreshToken:j,setUserData:e=>{t(e),f(!1),p(null)},fetchUser:P,clearError:()=>p(null),extendSession:A,handleInactivityLogout:L},children:(0,a.jsxs)(a.Fragment,{children:[e,(0,a.jsx)(l,{}),(0,a.jsx)(c,{})]})})}let h=()=>{let e=(0,s.useContext)(u);return e||{user:null,loading:!1,error:null,showInactivityModal:!1,timeRemaining:120,login:async()=>({success:!1}),signup:async()=>({success:!1}),logout:async()=>{},forgotPassword:async()=>({success:!1}),resetPassword:async()=>({success:!1}),verifyEmail:async()=>({success:!1}),refreshToken:async()=>!1,setUserData:()=>{},fetchUser:async()=>null,clearError:()=>{},extendSession:()=>{},handleInactivityLogout:()=>{}}}}}]);