"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8393],{5669:(e,r,t)=>{t.d(r,{e:()=>n});var s=t(41463);window.origin.startsWith("capacitor://");let a=s.env.NEXT_PUBLIC_API_URL||"https://actinova-backend.vercel.app";function n(e){if(!e)return a;if(e.startsWith("http://")||e.startsWith("https://"))return e;let r=e.startsWith("/")?e:`/${e}`;return`${a}${r}`}console.log("[Actinova] API_BASE_URL configured as:",a)},28393:(e,r,t)=>{t.d(r,{AuthProvider:()=>f,h:()=>h});var s=t(95155),a=t(12115),n=t(73321),c=t(37206),i=t(5669);let o=(0,c.default)(()=>t.e(7408).then(t.bind(t,27408)),{loadableGenerated:{webpack:()=>[27408]},ssr:!1}),l=(0,c.default)(()=>Promise.all([t.e(6609),t.e(2209)]).then(t.bind(t,2209)),{loadableGenerated:{webpack:()=>[2209]},ssr:!1}),u=(0,a.createContext)();function d(){if("undefined"==typeof document)return null;let e=document.cookie.match(/csrfToken=([^;]+)/);return e?e[1]:null}function f({children:e}){let[r,t]=(0,a.useState)(null),[c,f]=(0,a.useState)(!0),[h,m]=(0,a.useState)(null),[y,p]=(0,a.useState)(!1),[g,w]=(0,a.useState)(120),v=(0,n.useRouter)(),T=(0,n.usePathname)(),k=(0,a.useRef)(null),b=(0,a.useRef)(null),E=(0,a.useRef)(null),S=(0,a.useRef)(Date.now()),C=(0,a.useRef)(null);(0,a.useEffect)(()=>{},[]);let j=(0,a.useCallback)(async()=>(C.current||(C.current=(async()=>{try{if(!(await fetch((0,i.e)("/api/refresh"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})).ok)return!1;try{let e=await fetch((0,i.e)("/api/me"),{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(e.ok){let r=await e.json();t(r.user)}}catch(e){console.error("Failed to re-fetch profile after refresh:",e)}return!0}catch(e){return console.error("Token refresh failed:",e),!1}finally{C.current=null}})()),C.current),[]),P=(0,a.useCallback)(async()=>{try{m(null);let e=await fetch((0,i.e)("/api/me"),{credentials:"include",headers:{"Content-Type":"application/json"}}),r=null;if(e.ok)return r=await e.json(),t(r.user),f(!1),r.user;if(401===e.status&&await j()){let e=await fetch((0,i.e)("/api/me"),{credentials:"include",headers:{"Content-Type":"application/json"}});if(e.ok)return r=await e.json(),t(r.user),f(!1),r.user}return t(null),null}catch(e){console.error("Failed to fetch user:",e),m(e.message)}finally{f(!1)}},[j]);(0,a.useEffect)(()=>{P()},[P]),(0,a.useEffect)(()=>{if(!r)return;let e=async()=>{"visible"===document.visibilityState&&await j()};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[r,j]),(0,a.useEffect)(()=>{!c&&r&&T.startsWith("/auth")&&"/auth/verify-email"!==T&&(!1===r.onboardingCompleted?v.replace("/onboarding"):v.replace("/dashboard"))},[r,c,T,v]);let L=(0,a.useCallback)(()=>{S.current=Date.now(),k.current&&clearTimeout(k.current),b.current&&clearTimeout(b.current),E.current&&clearInterval(E.current),p(!1),w(120),r&&(b.current=setTimeout(()=>{p(!0),w(120),E.current=setInterval(()=>{w(e=>e<=1?(O(),0):e-1)},1e3)},78e4),k.current=setTimeout(()=>{O()},9e5))},[r]),O=(0,a.useCallback)(async()=>{k.current&&clearTimeout(k.current),b.current&&clearTimeout(b.current),E.current&&clearInterval(E.current);try{await fetch((0,i.e)("/api/logout"),{method:"POST",credentials:"include",headers:{"X-CSRF-Token":d()}})}catch(e){console.error("Logout failed:",e)}t(null),p(!1),v.push("/?loggedOut=inactivity")},[v]),R=(0,a.useCallback)(()=>{L()},[L]);(0,a.useEffect)(()=>{if(!r)return;let e=["mousedown","mousemove","keypress","scroll","touchstart","click"],t=()=>{L()};return e.forEach(e=>{document.addEventListener(e,t,!0)}),L(),()=>{e.forEach(e=>{document.removeEventListener(e,t,!0)}),k.current&&clearTimeout(k.current),b.current&&clearTimeout(b.current),E.current&&clearInterval(E.current)}},[r,L]),(0,a.useEffect)(()=>{r||(k.current&&clearTimeout(k.current),b.current&&clearTimeout(b.current),E.current&&clearInterval(E.current),p(!1))},[r]);let I=async e=>{try{m(null),f(!0);let r=await fetch((0,i.e)("/api/login"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)}),t=await r.json();if(!r.ok){if(console.error("[Actinova] Login failed status:",r.status,"data:",t),t.requiresVerification)return{success:!1,error:t.error||"Please verify your email first",requiresVerification:!0,email:t.email};throw Error(t.error||"Login failed")}console.log("[Actinova] Login successful, fetching user profile...");let s=await P();return{success:!0,user:s}}catch(e){return console.error("[Actinova] Login exception:",e),m(e.message),{success:!1,error:e.message}}finally{f(!1)}},_=async e=>{try{m(null),f(!0);let r=await fetch((0,i.e)("/api/signup"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)}),t=await r.json();if(!r.ok)throw Error(t.error||"Signup failed");return{success:!0,message:t.message,requiresVerification:t.requiresVerification}}catch(e){return m(e.message),{success:!1,error:e.message}}finally{f(!1)}},x=async()=>{try{m(null),await fetch((0,i.e)("/api/logout"),{method:"POST",credentials:"include",headers:{"X-CSRF-Token":d()}})}catch(e){console.error("Logout failed:",e)}finally{t(null),m(null),v.push("/")}},A=async e=>{try{m(null);let r=await fetch((0,i.e)("/api/forgot-password"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),t=await r.json();if(!r.ok)throw Error(t.error||"Failed to send reset email");return{success:!0,message:t.message}}catch(e){return m(e.message),{success:!1,error:e.message}}},F=async(e,r,t)=>{try{m(null);let s=await fetch((0,i.e)("/api/reset-password"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,password:r,confirmPassword:t})}),a=await s.json();if(!s.ok)throw Error(a.error||"Failed to reset password");return{success:!0,message:a.message}}catch(e){return m(e.message),{success:!1,error:e.message}}},N=async e=>{try{m(null);let r=await fetch((0,i.e)("/api/verify-email"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})}),t=await r.json();if(!r.ok)throw Error(t.error||"Failed to verify email");return{success:!0,message:t.message}}catch(e){return m(e.message),{success:!1,error:e.message}}};return(0,s.jsx)(u.Provider,{value:{user:r,loading:c,error:h,showInactivityModal:y,timeRemaining:g,login:I,signup:_,logout:x,forgotPassword:A,resetPassword:F,verifyEmail:N,refreshToken:j,setUserData:e=>{t(e),f(!1),m(null)},fetchUser:P,clearError:()=>m(null),extendSession:R,handleInactivityLogout:O},children:(0,s.jsxs)(s.Fragment,{children:[e,(0,s.jsx)(l,{}),(0,s.jsx)(o,{})]})})}let h=()=>{let e=(0,a.useContext)(u);return e||{user:null,loading:!1,error:null,showInactivityModal:!1,timeRemaining:120,login:async()=>({success:!1}),signup:async()=>({success:!1}),logout:async()=>{},forgotPassword:async()=>({success:!1}),resetPassword:async()=>({success:!1}),verifyEmail:async()=>({success:!1}),refreshToken:async()=>!1,setUserData:()=>{},fetchUser:async()=>null,clearError:()=>{},extendSession:()=>{},handleInactivityLogout:()=>{}}}}}]);