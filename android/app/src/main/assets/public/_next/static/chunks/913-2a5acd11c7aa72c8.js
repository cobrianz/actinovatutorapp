"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[913],{30913:(t,e,i)=>{i.d(e,{O5:()=>f,n$:()=>w,Iu:()=>F,D6:()=>C});var o=i(18831),a=i(28776),r=i(71876),l=i(82201),s=i.n(l);let n={primary:[37,99,235],primaryLight:[239,246,255],text:[31,41,55],textLight:[107,114,128],divider:[229,231,235]},c=t=>t?t.replace(/(\*\*|__)(.*?)\1/g,"$2").replace(/(\*|_)(.*?)\1/g,"$2").replace(/~~(.*?)~~/g,"$1").replace(/`([^`]+)`/g,"$1").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").replace(/\\\[(.*?)\\\]/g,"$1").replace(/^\s*#+\s*/,"").trim():"",h=async(t,e,o,a,r="File")=>{if(window.Capacitor||"capacitor:"===window.location.protocol)try{let l=t.output("datauristring").split(",")[1],{Filesystem:s,Directory:n}=await Promise.all([i.e(7805),i.e(8276)]).then(i.bind(i,78276)).catch(()=>({})),{Share:c}=await Promise.all([i.e(7805),i.e(8493)]).then(i.bind(i,98493)).catch(()=>({})),{LocalNotifications:h}=await Promise.all([i.e(7805),i.e(9968)]).then(i.bind(i,59968)).catch(()=>({}));try{let t=await s.requestPermissions();"granted"!==t.publicStorage&&console.warn("Storage permission not granted, falling back to app-specific storage.")}catch(t){}let d=await s.writeFile({path:e,data:l,directory:n.Downloads||n.Documents,recursive:!0});if(h)try{await h.schedule({notifications:[{title:"Download Successful",body:a||`The ${r.toLowerCase()} for "${o}" is ready.`,id:Math.floor(1e5*Math.random()),schedule:{at:new Date(Date.now()+500)},sound:null,attachments:[],smallIcon:"res://ic_stat_name",iconColor:"#2563EB"}]})}catch(t){console.error("[PDF] Notification error:",t)}if(c)try{await c.share({title:`${r} Downloaded`,text:`Successfully downloaded ${o}. Find it in your device's Downloads folder.`,url:d.uri,dialogTitle:"Share or Open Document"})}catch(t){console.error("[PDF] Share error:",t)}}catch(i){console.error("Capacitor PDF error (falling back to web save):",i),t.save(e)}else t.save(e)},d=(t,e,i)=>{t.setDrawColor(...n.divider),t.setLineWidth(.1),t.line(20,15,190,15),t.line(20,282,190,282),t.setFont("helvetica","normal"),t.setFontSize(8),t.setTextColor(...n.textLight);let o=new Date().getFullYear();t.text(`\xa9 ${o} Actinova AI Tutor - Premium Study Material`,20,287),t.text(`Page ${e} of ${i}`,190,287,{align:"right"})},x=(t,e,i)=>i+e>272?(t.addPage(),d(t,t.internal.getNumberOfPages(),t.internal.getNumberOfPages()),25):i,g=async(t,e,i,o,a,r=11,l)=>{let s=a-(i-20);t.setFontSize(r),t.setTextColor(...n.text);let c=e.trim().replace(/^[#\s]+/,"").replace(/\\\[(.*?)\\\]/g,"$1");if(!c)return o;let h=RegExp("(\\\\\\\\(?:[\\s\\S]*?)\\\\\\\\|\\$(?:[^$]+?)\\$|\\[.*?\\]\\(.*?\\)|`[^`]+`|\\*\\*.*?\\*\\*|__.*?__|(?<!\\*)\\*.*?\\*(?!\\*)|(?<!_)_.*?_(?!_)|~~.*?~~)","g"),d=c.split(h).filter(t=>t),x=[];for(let e of d){let i=e.match(/^(\\\(([\s\S]*?)\\\)|\$([^$]+?)\$)$/);if(i){let o=i[2]||i[3],a=await m(o.trim());if(a){let t=.3527*r*1.5,i=t*(a.width/a.height);x.push({type:"image",data:a.dataUrl,width:i,height:t,text:e})}else x.push({type:"text",text:e,width:t.getTextWidth(e)});continue}let o=e.match(/^\[(.*?)\]\((.*?)\)$/);if(o){let e=o[1],i=o[2];x.push({type:"link",text:e,url:i,width:t.getTextWidth(e)});continue}let a=e.match(/^`([^`]+)`$/);if(a){let e=a[1];t.setFont("courier","normal");let i=t.getTextWidth(e);t.setFont("helvetica","normal"),x.push({type:"code",text:e,width:i});continue}let l=e.startsWith("**")&&e.endsWith("**")||e.startsWith("__")&&e.endsWith("__"),s=e.startsWith("*")&&e.endsWith("*")||e.startsWith("_")&&e.endsWith("_"),n=e.startsWith("~~")&&e.endsWith("~~"),c=e;l?(c=e.slice(2,-2),t.setFont("helvetica","bold")):s?(c=e.slice(1,-1),t.setFont("helvetica","italic")):n&&(c=e.slice(2,-2)),t.getTextWidth(c),(l||s)&&t.setFont("helvetica","normal"),c.split(/(\s+)/).forEach(e=>{if(!e)return;let i=t.getTextWidth(e);x.push({type:"text",text:e,width:i,bold:l,italic:s,strike:n})})}let g=[],p=[],u=0;for(let t of x){if("\n"===t.text){g.push(p),p=[],u=0;continue}u+t.width>s?0===p.length?g.push([t]):(g.push(p),p=[t],u=t.width):(p.push(t),u+=t.width)}p.length>0&&g.push(p);let f=.3527*r*2;for(let e of g){o=l(t,f+2,o);let a=i;for(let i of e)"image"===i.type?t.addImage(i.data,"PNG",a,o-i.height+1,i.width,i.height):"code"===i.type?(t.setFont("courier","normal"),t.setFillColor(248,250,252),t.rect(a,o-r/1.5,i.width,r,"F"),t.setTextColor(220,38,38),t.text(i.text,a,o),t.setTextColor(...n.text),t.setFont("helvetica","normal")):"link"===i.type?(t.setTextColor(...n.primary),t.text(i.text,a,o),t.setDrawColor(...n.primary),t.setLineWidth(.1),t.line(a,o+1,a+i.width,o+1),t.link(a,o-r,i.width,r,{url:i.url}),t.setTextColor(...n.text)):(i.bold?t.setFont("helvetica","bold"):i.italic?t.setFont("helvetica","italic"):t.setFont("helvetica","normal"),t.text(i.text,a,o),i.strike&&(t.setDrawColor(...n.text),t.setLineWidth(.2),t.line(a,o-.25*r,a+i.width,o-.25*r)),t.setFont("helvetica","normal")),a+=i.width;o+=f}return o},p=async(t,e,i,o={})=>{let{margin:a=20,contentWidth:r=170,titleToSkip:l=null,isFirstLesson:s=!0}=o;if(!e)return i;let h=e.split("\n"),d=i,p=!1,f=[],w=[],F=[],C=[],T="",y=async()=>{if(0===C.length)return;let e=C.join(" ");d=await g(t,e,a,d,r,11,(e,i)=>x(t,e,i)),C=[]},S=async()=>{if(0===f.length)return;await y(),d=x(t,25,d)+5;let e=f.map(t=>t.split("|").map(t=>t.trim()).filter(t=>""!==t));if(e.length<2)return;let i=e[0],o=(r-10)/i.length;t.setFillColor(245,247,250),t.rect(a,d,r,10,"F"),t.setFont("helvetica","bold"),t.setFontSize(10),t.setTextColor(...n.text),i.forEach((e,i)=>t.text(e,a+5+i*o,d+6)),d+=10,t.setFont("helvetica","normal"),e.slice(2).forEach((e,i)=>{d=x(t,10,d),i%2==1&&(t.setFillColor(249,250,251),t.rect(a,d,r,10,"F")),e.forEach((e,i)=>{let r=t.splitTextToSize(e,o-5);t.text(r,a+5+i*o,d+6)}),t.setDrawColor(230,230,230),t.line(a,d+10,210-a,d+10),d+=10}),d+=5,f=[]};for(let e of h){let i=e.trim();if(!i&&!p){await y(),d+=6;continue}if(i.startsWith("```mermaid")){await S(),await y(),p="mermaid",w=[];continue}if("mermaid"===p&&i.startsWith("```")){p=!1;let e=w.join("\n");if(e.trim()){let i=await u(e);if(i){let e=i.width/3*.264583,o=i.height/3*.264583,l=e,s=o;if(l>r){let t=s/l;s=(l=r)*t}d=x(t,s+15,d),t.addImage(i.dataUrl,"PNG",a+(r-l)/2,d,l,s),d+=s+10}}continue}if("mermaid"===p){w.push(e);continue}if("$$"===i||"\\["===i){await S(),await y(),p="latex",F=[];continue}if("latex"===p&&("$$"===i||"\\]"===i)){p=!1;let e=F.join("\n");if(e.trim()){let i=await m(e);if(i){let e=.24*i.width,o=.24*i.height,l=e,s=o;if(l>r){let t=s/l;s=(l=r)*t}d=x(t,s+10,d),t.addImage(i.dataUrl,"PNG",a+5,d,l,s),d+=s+10}}continue}if("latex"===p){F.push(e);continue}if(i.startsWith("```")){await S(),await y(),p=!0!==p;continue}if(!0===p){d=x(t,8,d),t.setFont("courier","normal"),t.setFontSize(10),t.setFillColor(248,250,252),t.rect(a+2,d-4,r-4,6,"F"),t.text(e,a+4,d),d+=6;continue}if(i.startsWith("|")&&i.endsWith("|")){await y(),f.push(i);continue}if(await S(),(i.startsWith("# ")||i.startsWith("## "))&&(T=c(i)),i.startsWith("#")&&!i.startsWith("# "),i.startsWith("# ")){await y();let e=c(i);if(l&&e.toLowerCase().includes(l.toLowerCase())&&s)continue;d+=5,t.setFont("helvetica","bold"),t.setFontSize(26),t.setTextColor(...n.primary),t.text(e,a,d),d+=5,t.setDrawColor(...n.primary),t.setLineWidth(.8),t.line(a,d-2,a+t.getTextWidth(e),d-2),d+=5}else if(i.startsWith("## ")){await y(),d+=5,t.setFont("helvetica","bold"),t.setFontSize(20),t.setTextColor(...n.primary);let e=c(i);t.text(e,a,d),d+=5,t.setDrawColor(...n.primaryLight),t.setLineWidth(.4),t.line(a,d-2,a+r,d-2)}else if(i.startsWith("### ")){await y(),d+=2.5,t.setFont("helvetica","bold"),t.setFontSize(16);let e=c(i);t.text(e,a,d),d+=5}else if(i.startsWith("#### ")){await y(),d+=5/3,t.setFont("helvetica","bold"),t.setFontSize(13),t.setTextColor(...n.text);let e=c(i);t.text(e,a,d),d+=4}else if(i.startsWith("##### ")){await y(),d+=5/4,t.setFont("helvetica","bold"),t.setFontSize(11),t.setTextColor(...n.text);let e=c(i);t.text(e,a,d),d+=4}else if(i.startsWith("###### ")){await y(),d+=1,t.setFont("helvetica","bold"),t.setFontSize(10),t.setTextColor(...n.text);let e=c(i);t.text(e,a,d),d+=4}else if(i.startsWith("> ")){await y();let e=i.substring(2).trim();t.setFont("helvetica","italic"),t.setTextColor(...n.textLight);let o=t.splitTextToSize(e,r-15);d=x(t,8*o.length+5,d),t.setDrawColor(...n.primary),t.setLineWidth(1.5),t.line(a+2,d-4,a+2,d+8*o.length-4),o.forEach(e=>{t.text(e,a+8,d),d+=8}),d+=5}else if(i.match(/^[-*•]\s/))await y(),T.toLowerCase().includes("practice exercises")?(t.setFont("helvetica","bold"),t.setTextColor(0,0,0),t.text("✓",a+2,d),d=await g(t,i.replace(/^[-*•]\s/,""),a+10,d,r,11,(e,i)=>x(t,e,i))):(t.setFont("helvetica","bold"),t.setTextColor(...n.primary),t.text("•",a+2,d),d=await g(t,i.replace(/^[-*•]\s/,""),a+8,d,r,11,(e,i)=>x(t,e,i)));else if(i.match(/^\d+\.\s/)){await y();let e=i.match(/^\d+\./)[0];t.setFont("helvetica","bold"),t.setTextColor(...n.primary),t.text(e,a,d),d=await g(t,i.replace(/^\d+\.\s/,""),a+10,d,r,11,(e,i)=>x(t,e,i))}else e.startsWith("    ")||e.startsWith("	")?(await y(),d=await g(t,i,a+10,d,r,11,(e,i)=>x(t,e,i))):C.push(i)}return await S(),await y(),d},u=async t=>{try{let e=t.replace(/\[([\s\S]*?)\]/g,(t,e)=>/[()",]/.test(e)?`["${e.trim().replace(/"/g,'""')}"]`:t),i=`mermaid-pdf-${Date.now()}-${Math.floor(1e4*Math.random())}`;a.A.initialize({startOnLoad:!1,theme:"default"});let{svg:o}=await a.A.render(i,e);return new Promise(t=>{let e=new Image,i=btoa(unescape(encodeURIComponent(o))),a=`data:image/svg+xml;base64,${i}`;e.onload=()=>{let i=document.createElement("canvas");i.width=3*e.width,i.height=3*e.height;let o=i.getContext("2d");o.fillStyle="#ffffff",o.fillRect(0,0,i.width,i.height),o.scale(3,3),o.drawImage(e,0,0),t({dataUrl:i.toDataURL("image/png"),width:e.width,height:e.height})},e.onerror=()=>t(null),e.src=a})}catch(t){return console.error("Mermaid render error:",t),null}},m=async t=>{try{let e=document.createElement("div");e.style.position="absolute",e.style.left="-9999px",e.style.top="-9999px",e.style.padding="20px",e.style.backgroundColor="#ffffff",e.style.display="inline-block",document.body.appendChild(e),r.default.render(t,e,{throwOnError:!1,displayMode:!0,output:"html"});let i=await s()(e,{backgroundColor:"#ffffff",scale:3}),o=i.toDataURL("image/png");return document.body.removeChild(e),{dataUrl:o,width:i.width/3,height:i.height/3}}catch(t){return console.error("LaTeX render error:",t),null}},f=async t=>{if(!t)throw Error("No data provided");let e=new o.Ay({orientation:"portrait",unit:"mm",format:"a4"}),i=30;e.setFillColor(...n.primaryLight),e.rect(0,0,210,297,"F");try{e.addImage("/logo.png","PNG",80,i,50,50),i+=70}catch(t){i+=30}e.setFont("helvetica","bold"),e.setFontSize(40),e.setTextColor(...n.primary),e.text("ACTINOVA",105,i,{align:"center"}),i+=15,e.setFontSize(18),e.setTextColor(...n.textLight),e.text("AI Tutor Platform",105,i,{align:"center"}),i=140,e.setFillColor(255,255,255),e.setDrawColor(...n.primary),e.setLineWidth(2),e.roundedRect(20,i,170,80,10,10,"FD"),e.setTextColor(...n.primary),e.setFontSize(32),e.setFontSize(32);let a=e.splitTextToSize(c(t.title)||"Full Course Material",130);e.text(a,105,i+30,{align:"center"}),e.setFontSize(14),e.setTextColor(...n.textLight),e.text("Personalized Course Textbook",105,i+60,{align:"center"}),e.text(`Generated: ${new Date().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}`,105,i+75,{align:"center"}),e.addPage(),i=40;let r=t.modules||t.courseData?.modules||[];e.setFont("helvetica","bold"),e.setFontSize(28),e.setTextColor(...n.primary),e.text("Table of Contents",20,i),i+=20,r.forEach((t,o)=>{i=x(e,20,i),e.setFontSize(16),e.setFontSize(16),e.setTextColor(...n.text),e.text(`Module ${o+1}: ${c(t.title)}`,20,i),i+=12,t.lessons&&t.lessons.forEach((t,a)=>{i=x(e,10,i),e.setFontSize(12),e.setFontSize(12),e.setTextColor(...n.textLight),e.text(`  ${o+1}.${a+1}  ${c(t.title)||"Untitled Lesson"}`,25,i),i+=8}),i+=8});for(let t=0;t<r.length;t++){let o=r[t];e.addPage(),i=40,e.setFont("helvetica","bold"),e.setFontSize(34),e.setTextColor(...n.primary),e.text(`MODULE ${t+1}`,20,i),i+=18,e.setFontSize(24),e.setTextColor(...n.text),e.setFontSize(24),e.setTextColor(...n.text);let a=e.splitTextToSize(c(o.title).toUpperCase(),170);if(e.text(a,20,i),i+=12*a.length+20,o.lessons){for(let a=0;a<o.lessons.length;a++){let r=o.lessons[a];e.addPage(),i=40,d(e,e.getNumberOfPages(),l),e.setFont("helvetica","bold"),e.setFontSize(20),e.setFontSize(20),e.setTextColor(...n.primary);let s=`${t+1}.${a+1} ${c(r.title)||"Lesson"}`,h=e.splitTextToSize(s,170);e.text(h,20,i),i+=10*h.length+15,r.content&&(i=await p(e,r.content,i,{titleToSkip:c(r.title),isFirstLesson:!0}))}i+=20}}let l=e.getNumberOfPages();for(let t=1;t<=l;t++)e.setPage(t),d(e,t,l);let s=`${(c(t.title)||"course").replace(/\s+/g,"_").toLowerCase()}.pdf`;await h(e,s,c(t.title),`Your full course textbook "${c(t.title)}" is ready.`,"Course")},w=async t=>{if(!t||!t.content)throw Error("No content provided");let e=new o.Ay({orientation:"portrait",unit:"mm",format:"a4"}),i=25;e.setFillColor(255,255,255),e.rect(0,0,210,297,"F"),i=40;try{e.addImage("/logo.png","PNG",85,i,40,40),i+=45}catch(t){i=80}i+=16,e.setTextColor(...n.text),e.setFont("helvetica","bold"),e.setFontSize(40),e.text("STUDY NOTES",105,i,{align:"center"}),i=150;let a=e.splitTextToSize(c(t.title)||"Lesson Material",130),r=40+12*a.length+20;e.setDrawColor(...n.primary),e.setLineWidth(.5),e.roundedRect(20,i-15,170,r,2,2,"D"),e.setTextColor(...n.primary),e.setFontSize(14),e.text("PERSONALIZED ACADEMIC CONTENT",105,i,{align:"center"}),i+=15,e.setTextColor(...n.text),e.setFontSize(28),e.text(a,105,i,{align:"center",maxWidth:130}),i+=12*a.length+10,e.setFontSize(12),e.setTextColor(...n.textLight),e.text(`Generated on ${new Date().toLocaleDateString()}`,105,i,{align:"center"}),e.addPage(),i=30,e.setFont("helvetica","bold"),e.setFontSize(22),e.setTextColor(...n.primary);let l=e.splitTextToSize(c(t.title)||"Lesson Material",170);e.text(l,20,i),i+=8*l.length+6,i=await p(e,t.content,i,{titleToSkip:c(t.title),isFirstLesson:!0});let s=e.internal.pages.length-1;for(let t=1;t<=s;t++)e.setPage(t),d(e,t,s);let x=`${c(t.title)?.replace(/\s+/g,"_").toLowerCase()||"lesson"}.pdf`;await h(e,x,c(t.title),"Your lesson notes are ready.","Lesson")},F=async t=>{if(!t||!t.questions)throw Error("No data provided");let e=new o.Ay({orientation:"portrait",unit:"mm",format:"a4"}),i=40,a=(i,o)=>{e.setDrawColor(...n.divider),e.setLineWidth(.1),e.line(20,15,190,15),e.setFontSize(8),e.setTextColor(...n.textLight),e.text(`Actinova AI Tutor - Assessment: ${t.title}`,20,12),i&&e.text(`Page ${i} of ${o}`,190,12,{align:"right"})};a(),e.setFont("helvetica","bold"),e.setFontSize(24),e.setTextColor(...n.primary),e.text("ASSESSMENT PAPER",105,i,{align:"center"}),i+=12,e.setFontSize(14),e.setTextColor(...n.textLight),e.text(`Subject: ${t.topic||"General Knowledge"}`,105,i,{align:"center"}),i+=20,t.questions.forEach((t,o)=>{let a=e.splitTextToSize(`${o+1}. ${t.text}`,160),r=8*(t.options?.length||0);i=x(e,6*a.length+r+20,i),e.setFont("helvetica","bold"),e.setFontSize(12),e.setTextColor(...n.text),e.text(a,20,i),i+=6*a.length+4,t.options&&(e.setFont("helvetica","normal"),e.setFontSize(11),t.options.forEach((t,o)=>{e.setTextColor(...n.textLight),e.text(String.fromCharCode(65+o)+")",25,i),e.setTextColor(...n.text),e.text(e.splitTextToSize(t,150),35,i),i+=8})),i+=6}),e.addPage(),a(),i=30,e.setFont("helvetica","bold"),e.setFontSize(18),e.setTextColor(...n.primary),e.text("ANSWER KEY",20,i),i+=15,e.setFontSize(11),t.questions.forEach((t,o)=>{i=x(e,10,i),e.setFont("helvetica","bold"),e.setTextColor(...n.text),e.text(`${o+1}: `,20,i),e.setFont("helvetica","normal"),e.setTextColor(...n.primary),e.text(String(t.correctAnswer),30,i),i+=10});let r=e.internal.pages.length-1;for(let t=1;t<=r;t++)e.setPage(t),a(t,r);let l=`assessment_${t.title?.replace(/\s+/g,"_").toLowerCase()||"exam"}.pdf`;await h(e,l,t.title,"Assessment downloaded successfully.","Assessment")},C=async(t,e="Scholar")=>{if(!t)throw Error("No data provided");let i=new o.Ay({orientation:"portrait",unit:"mm",format:"a4"}),a=30;i.setFontSize(70),i.setTextColor(240,240,240),i.text("ACTINOVA",105,160,{align:"center"});try{i.addImage("/logo.png","PNG",85,a,40,40),a+=55}catch(t){a+=10}i.setFillColor(...n.primary),i.rect(20,a,170,15,"F"),i.setFont("helvetica","bold"),i.setFontSize(18),i.setTextColor(255,255,255),i.text("PAYMENT RECEIPT",105,a+10,{align:"center"}),a+=30,i.setTextColor(...n.text),i.setFontSize(22),i.text("Actinova AI Tutor",105,a,{align:"center"}),a+=12,i.setFontSize(12),i.setTextColor(...n.textLight),i.text("Your Intelligent Learning Companion",105,a,{align:"center"}),a+=20,i.setFontSize(12),i.setTextColor(...n.text),i.text(`Billed to: ${e}`,105,a,{align:"center"}),a+=20,i.setFont("helvetica","bold"),i.setFontSize(16),i.text("Thank you for your subscription!",105,a,{align:"center"}),a+=25;let r=new Date(t.date||t.paidAt||Date.now()).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"});i.setFontSize(11),i.setFont("helvetica","bold"),i.text("Date:",30,a),i.text(r,70,a),i.text("Plan:",115,a),i.text(t.plan||"Pro",145,a),a+=10,i.text("Receipt #:",30,a),i.text(t.reference?.toUpperCase()||"N/A",70,a),i.text("Status:",115,a),i.setTextColor(...n.success),i.text("PAID",145,a),a+=20,i.setFontSize(20),i.setTextColor(...n.primary);let l=new Intl.NumberFormat("en-US",{style:"currency",currency:t.currency||"USD"}).format(t.amount||0);i.text(`Amount: ${l}`,105,a,{align:"center"}),a+=30,i.setFontSize(10),i.setTextColor(...n.textLight),i.text("This is an official receipt. Contact support@actinova.ai for questions.",105,a,{align:"center"});let s=`receipt-${t.reference||"payment"}.pdf`;await h(i,s,"Subscription Payment","Your receipt has been downloaded.","Receipt")}}}]);