"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8126],{98126:(t,e,o)=>{o.d(e,{D6:()=>g,Iu:()=>d,O5:()=>h});var i=o(18831),l=o(28776);let a=[37,99,235],r=[31,41,55],n=[107,114,128],s=[229,231,235],c=async(t,e,i,l,a="File")=>{if(window.Capacitor||"capacitor:"===window.location.protocol)try{let r=t.output("datauristring").split(",")[1],{Filesystem:n,Directory:s}=await Promise.all([o.e(7805),o.e(8276)]).then(o.bind(o,78276)).catch(()=>({})),{Share:c}=await Promise.all([o.e(7805),o.e(8493)]).then(o.bind(o,98493)).catch(()=>({})),{LocalNotifications:h}=await Promise.all([o.e(7805),o.e(9968)]).then(o.bind(o,59968)).catch(()=>({}));if(!n||!c||!h)throw Error("Capacitor plugins not available");try{await h.requestPermissions()}catch(t){console.warn("Notification permissions denied",t)}let d=await n.writeFile({path:e,data:r,directory:s.Documents});await h.schedule({notifications:[{title:"Download Complete",body:l,id:Math.floor(1e5*Math.random()),schedule:{at:new Date(Date.now()+100)},sound:null,attachments:null,actionTypeId:"",extra:null}]}),await c.share({title:`Actinova ${a} Download`,text:`${a} for ${i}`,url:d.uri,dialogTitle:"Save or Open PDF"})}catch(o){console.error("Capacitor PDF error:",o),t.save(e)}else t.save(e)},h=async(t,e="course")=>{if(!t)throw Error("No data provided");let o=new i.Ay({orientation:"portrait",unit:"mm",format:"a4"}),h=25,d=async t=>{try{let e=t.replace(/\[([\s\S]*?)\]/g,(t,e)=>/[()",]/.test(e)?`["${e.trim().replace(/"/g,'""')}"]`:t),o=`mermaid-pdf-${Date.now()}-${Math.floor(1e4*Math.random())}`;l.A.initialize({startOnLoad:!1,theme:"default"});let{svg:i}=await l.A.render(o,e);return new Promise((t,e)=>{let o=new Image,l=btoa(unescape(encodeURIComponent(i))),a=`data:image/svg+xml;base64,${l}`;o.onload=()=>{let e=document.createElement("canvas");e.width=3*o.width,e.height=3*o.height;let i=e.getContext("2d");i.fillStyle="#ffffff",i.fillRect(0,0,e.width,e.height),i.scale(3,3),i.drawImage(o,0,0),t({dataUrl:e.toDataURL("image/png"),width:o.width,height:o.height})},o.onerror=e=>{console.error("Image load error",e),t(null)},o.crossOrigin="anonymous",o.src=a})}catch(t){return console.error("Mermaid render error:",t),null}},g=(t,e)=>{o.setDrawColor(...s),o.setLineWidth(.2),o.line(20,15,190,15),o.line(20,282,190,282),o.setFont("helvetica","normal"),o.setFontSize(8),o.setTextColor(...n),o.text("Actinova AI Tutor - Personalized Learning",20,287),o.text("Copyright \xa9 Actinova AI Tutor. All rights reserved.",105,287,{align:"center"}),o.text(`Page ${t} of ${e}`,190,287,{align:"right"})},x=t=>h+t>272&&(o.addPage(),h=25,!0);o.setFillColor(255,255,255),o.rect(0,0,210,297,"F"),h=40;try{o.addImage("/logo.png","PNG",85,h,40,40),h+=45}catch(t){h=80}h+=16,o.setTextColor(...r),o.setFont("helvetica","bold"),o.setFontSize(48),o.text("ACTINOVA",105,h,{align:"center"}),h+=12,o.setFontSize(24),o.text("AI TUTOR PLATFORM",105,h,{align:"center"}),h=150;let m=o.splitTextToSize(t.title||"Study Material",150),u=12*m.length;o.setDrawColor(...a),o.setLineWidth(.5),o.roundedRect(15,h-15,180,40+u+20,2,2,"D"),o.setTextColor(...a),o.setFontSize(14),o.text("NOTES"===e.toUpperCase()?"PERSONALIZED STUDY NOTES":"PERSONALIZED COURSE MATERIAL",105,h,{align:"center"}),h+=15,o.setTextColor(...r),o.setFontSize(28),o.text(m,105,h,{align:"center"}),h+=12*m.length+10,o.setFontSize(12),o.setTextColor(...n),o.text(`Generated on ${new Date().toLocaleDateString()}`,105,h,{align:"center"}),o.addPage(),h=30;let p=(t,e,i=11)=>{o.setFontSize(i),o.setFont("helvetica","normal"),o.setTextColor(...r);let l=t.replace(/!\[([^\]]*)\]\([^\)]+\)/g,"$1").replace(/\[([^\]]+)\]\([^\)]+\)/g,"$1").replace(/https?:\/\/[^\s\)]+/g,"").replace(/(\*\*|__)(.*?)\1/g,"$2").replace(/(\*|_)(.*?)\1/g,"$2").replace(/~~(.*?)~~/g,"$1").replace(/`([^`]+)`/g,"$1").replace(/^#+\s+/,"").replace(/^>\s+/,"").replace(/^[-*_]{3,}\s*$/,"").replace(/^[-*•]\s+/,"").replace(/^\d+\.\s+/,"").trim();o.splitTextToSize(l,170-(e-20)).forEach(t=>{x(8),o.text(t,e,h),h+=7})},F=async(t,e=null)=>{if(!t)return;let i=t.split("\n"),l=!1,c=!0,g=[],m=[],u=()=>{if(0===g.length)return;x(20),h+=5;let t=g.map(t=>t.split("|").map(t=>t.trim()).filter(t=>""!==t));if(t.length<2)return;let e=t[0],i=160/e.length;o.setFillColor(245,247,250),o.rect(20,h,170,10,"F"),o.setFont("helvetica","bold"),o.setFontSize(10),o.setTextColor(...r),e.forEach((t,e)=>{o.text(t,25+e*i,h+6)}),h+=10,o.setFont("helvetica","normal"),t.slice(2).forEach((t,e)=>{x(10),e%2==1&&(o.setFillColor(249,250,251),o.rect(20,h,170,10,"F")),t.forEach((t,e)=>{let l=o.splitTextToSize(t,i-5);o.text(l,25+e*i,h+6)}),o.setDrawColor(230,230,230),o.line(20,h+10,190,h+10),h+=10}),h+=5,g=[]};for(let t of i){let i=t.trim();if(i.startsWith("```")){if(u(),"mermaid"===i.substring(3).trim())l="mermaid",m=[];else if("mermaid"===l){l=!1;let t=m.join("\n");if(t.trim()){let e=await d(t);if(e){let t=160,i=.264583*e.width,l=e.height/e.width,a=Math.min(t,i);a<.5*t&&i>100&&(a=.7*t),i>t&&(a=t);let r=a*l;x(r+10),h+=5;try{o.addImage(e.dataUrl,"PNG",(210-a)/2,h,a,r),h+=r+5}catch(t){console.error("PDF AddImage failed",t)}}}}else l=!l;h+=2,c=!1;continue}if("mermaid"===l){m.push(t);continue}if(l){o.setFont("courier","normal"),o.setFontSize(10),o.setFillColor(248,250,252),o.rect(22,h-4,166,6,"F"),o.text(t,24,h),h+=6,o.setFont("helvetica","normal"),c=!1;continue}if(i.startsWith("|")&&i.endsWith("|")){g.push(i);continue}if(u(),!i.startsWith("#")&&!i.startsWith(">")&&(i.includes("---|")||i.includes("/ \\")||i.includes(" +--")||i.includes(" | "))){o.setFont("courier","normal"),x(6),o.text(t,20,h),h+=6,o.setFont("helvetica","normal");continue}if(["---","***","___"].includes(i)){x(5),h+=4,c=!1;continue}if(!i){h+=5,c=!1;continue}if(x(12),i.match(/^#? ?Module:.*/i)){c=!1;continue}if(i.startsWith("## LESSON: ")||i.startsWith("LESSON: ")||i.startsWith("Lesson: ")){h+=2,o.setFont("helvetica","bold"),o.setFontSize(20),o.setTextColor(...a);let t=i.replace(/^##\s*/,"").replace(/^LESSON:\s*/i,"");t=t.toUpperCase();let e=o.splitTextToSize(t,170);o.text(e,20,h),h+=10*e.length,h+=2,c=!1;continue}if(c&&!i.startsWith("#")&&!i.startsWith("##")&&!i.startsWith("###")&&!i.startsWith("> ")&&!i.match(/^[-*•]\s/)&&!i.match(/^\d+\.\s/)){h+=2,o.setFont("helvetica","bold"),o.setFontSize(26),o.setTextColor(...a);let t=o.splitTextToSize(i,160);o.text(t,20,h),h+=12*t.length+4,c=!1;continue}if(c=!1,i.startsWith("# ")){let t=i.substring(2).replace(/[\*_]/g,"").trim();if(e&&t.toLowerCase().includes(e.toLowerCase()))continue;h+=2,o.setFont("helvetica","bold"),o.setFontSize(26),o.setTextColor(...a);let l=o.splitTextToSize(t,170);o.text(l,20,h),h+=12*l.length+4}else if(i.startsWith("## ")){h+=2,o.setFont("helvetica","bold"),o.setFontSize(20),o.setTextColor(...a);let t=i.substring(3).replace(/[\*_]/g,"").trim(),e=o.splitTextToSize(t,170);o.text(e,20,h),h+=10*e.length,h+=2}else if(i.startsWith("### ")){h+=2,o.setFont("helvetica","bold"),o.setFontSize(16),o.setTextColor(...r);let t=i.substring(4).replace(/[\*_]/g,"").trim(),e=o.splitTextToSize(t,170);o.text(e,20,h),h+=9*e.length+2}else if(i.startsWith("#### ")){h+=2,o.setFont("helvetica","bold"),o.setFontSize(14),o.setTextColor(...r);let t=i.substring(5).replace(/[\*_]/g,"").trim(),e=o.splitTextToSize(t,170);o.text(e,20,h),h+=8*e.length+2}else if(i.startsWith("> ")){let t=i.substring(2).trim();o.setFont("helvetica","italic"),o.setTextColor(...n);let e=o.splitTextToSize(t,160);x(6*e.length+4),o.setDrawColor(...s),o.setLineWidth(1),o.line(22,h-4,22,h+6*e.length-4),o.text(e,28,h),h+=6*e.length+4,o.setFont("helvetica","normal")}else if(i.match(/^[-*•]\s/))o.setFont("helvetica","bold"),o.setTextColor(...a),o.text("•",22,h),p(i.replace(/^[-*•]\s/,""),28);else if(i.match(/^\d+\.\s/)){let t=i.match(/^\d+\./)[0];o.setFont("helvetica","bold"),o.setTextColor(...a),o.text(t,20,h),p(i.replace(/^\d+\.\s/,""),30)}else p(i,20)}u()};if("course"===e){let e=t.modules||t.courseData?.modules||[];o.setFont("helvetica","bold"),o.setFontSize(24),o.setTextColor(...a),o.text("Table of Contents",20,h),h+=15,e.forEach((t,e)=>{x(12),o.setFontSize(12),o.setFont("helvetica","normal"),o.setTextColor(...r),o.text(`Module ${e+1}: ${t.title}`,20,h),h+=8});for(let t=0;t<e.length;t++){let i=e[t];if(o.addPage(),h=35,i.lessons)for(let e=0;e<i.lessons.length;e++){let l=i.lessons[e];x(20),o.setFont("helvetica","bold"),o.setFontSize(16),o.setTextColor(...r),o.text(`${t+1}.${e+1} ${l.title||l}`,20,h),h+=12,l.content&&await F(l.content,l.title||l),h+=10}}}else await F(t.content,t.title);let T=o.internal.pages.length-1;for(let t=1;t<=T;t++)o.setPage(t),g(t,T);let f=`${t.title?.replace(/\s+/g,"_").toLowerCase()||"actinova_study"}.pdf`;await c(o,f,t.title,`${t.title} saved to Documents. Tap to view.`,"Study Material")},d=async t=>{if(!t||!t.questions)throw Error("No data provided");let e=new i.Ay({orientation:"portrait",unit:"mm",format:"a4"}),o=40,l=(o,i)=>{e.setDrawColor(...s),e.setLineWidth(.2),e.line(20,15,190,15),e.setFontSize(8),e.setTextColor(...n),e.text(`Actinova AI Tutor - Assessment: ${t.title}`,20,12),o&&e.text(`Page ${o} of ${i}`,190,12,{align:"right"})};l(),e.setFont("helvetica","bold"),e.setFontSize(24),e.setTextColor(...a),e.text("ASSESSMENT PAPER",105,o,{align:"center"}),o+=12,e.setFontSize(14),e.setTextColor(...n),e.text(`Subject: ${t.topic||"General Knowledge"}`,105,o,{align:"center"}),o+=20,t.questions.forEach((t,i)=>{let a=e.splitTextToSize(`${i+1}. ${t.text}`,160),s=8*(t.options?.length||0);o+6*a.length+s+20>267&&(e.addPage(),l(),o=25),e.setFont("helvetica","bold"),e.setFontSize(12),e.setTextColor(...r),e.text(a,20,o),o+=6*a.length+2,t.options?(e.setFont("helvetica","normal"),e.setFontSize(11),t.options.forEach((t,i)=>{e.setTextColor(...n),e.text(String.fromCharCode(65+i)+")",25,o),e.setTextColor(...r),e.text(e.splitTextToSize(t,150),35,o),o+=6})):o+=10,o+=5}),e.addPage(),l(),o=30,e.setFont("helvetica","bold"),e.setFontSize(18),e.setTextColor(...a),e.text("ANSWER KEY",20,o),o+=15,e.setFontSize(11),t.questions.forEach((t,i)=>{o>277&&(e.addPage(),l(),o=25),e.setFont("helvetica","bold"),e.setTextColor(...r),e.text(`${i+1}: `,20,o),e.setFont("helvetica","normal"),e.setTextColor(...a),e.text(String(t.correctAnswer),30,o),o+=6});let h=e.internal.pages.length-1;for(let t=1;t<=h;t++)e.setPage(t),l(t,h);let d=`assessment_${t.title?.replace(/\s+/g,"_").toLowerCase()||"exam"}.pdf`;await c(e,d,t.title,`Assessment for ${t.title} saved to Documents.`,"Assessment")},g=async t=>{if(!t)throw Error("No data provided");let e=new i.Ay({orientation:"portrait",unit:"mm",format:"a4"}),o=40;e.setFillColor(248,250,252),e.rect(0,0,210,50,"F"),e.setFont("helvetica","bold"),e.setFontSize(24),e.setTextColor(...a),e.text("RECEIPT",190,25,{align:"right"}),e.setFontSize(10),e.setTextColor(...n),e.text("PAYMENT CONFIRMATION",190,32,{align:"right"}),e.setFontSize(18),e.setTextColor(...r),e.text("Actinova AI Tutor",20,25),e.setFontSize(10),e.setTextColor(...n),e.text("123 Learning Lane, EdTech City",20,32),o=80;let l=(t,i,l=!1)=>{e.setFont("helvetica","normal"),e.setFontSize(10),e.setTextColor(...n),e.text(t,20,o),e.setFont("helvetica",l?"bold":"normal"),e.setTextColor(...r),e.text(i,190,o,{align:"right"}),o+=8};l("Reference ID",t.reference||"N/A"),l("Date",new Date(t.date||t.paidAt||Date.now()).toLocaleDateString()),l("Plan",t.plan||"Premium Subscription"),l("Billing Cycle",t.billingCycle||"Monthly"),o+=12,e.setFont("helvetica","bold"),e.setFontSize(14),e.setTextColor(...r),e.text("Total Amount",20,o),e.setFontSize(18),e.setTextColor(...a),e.text(new Intl.NumberFormat("en-US",{style:"currency",currency:t.currency||"USD"}).format(t.amount||0),190,o,{align:"right"}),o+=40,e.setFont("helvetica","normal"),e.setFontSize(9),e.setTextColor(...n),e.text("Thank you for your business!",105,o,{align:"center"});let s=`receipt-${t.reference||"transaction"}.pdf`;await c(e,s,t.plan||"Subscription",`Receipt for ${t.plan||"Subscription"} saved to Documents.`,"Receipt")}}}]);